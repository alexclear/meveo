<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j" xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	template="/layout/template.xhtml" xmlns:p="http://primefaces.org/ui">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{userAccountBean.preRenderView}" />

			<f:viewParam name="userAccountId" value="#{userAccountBean.objectId}" />
			<f:viewParam name="billingAccountId"
				value="#{userAccountBean.billingAccountId}" />
			<f:viewParam name="billingAccountId"
				value="#{billingAccountBean.objectId}" />
			<f:viewParam name="customerAccountId"
				value="#{customerAccountBean.objectId}" />
			<f:viewParam name="customerId" value="#{customerBean.objectId}" />
		</f:metadata>
	</ui:define>

	<ui:define name="navigation">
		<ui:include src="/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">

		<hftl:entityPopup id="billingAccountPopup"
			header="#{messages['billingAccount.popup.header']}"
			backingBean="#{billingAccountBean}"
			searchField1Label="#{messages['billingAccount.code']}"
			searchField1="code" column1Label="#{messages['billingAccount.code']}"
			column1="code" selection="#{userAccountBean.entity.billingAccount}"
			updateField=":userAccountFormPanel:formId:userAccountTab:billingAccountSelectId:billingAccountSelectId">

			<!-- 			<a:commandLink value="#{messages['commons.select']}" render="formId" immediate="true" action="#{userAccountBean.populateAccounts(entity)}" -->
			<!-- 				oncomplete="dlg_billingAccountPopup.hide()"> -->
			<!-- 			</a:commandLink> -->
		</hftl:entityPopup>


		<hftl:entityPopup id="walletOperationPopup"
			dataModel="#{userAccountBean.getWalletOperationsNoInvoiced()}"
			header="#{messages['ratedTransactionsNoInvoiced.popup.header']}"
			showSearchButton="false" backingBean="#{walletOperationBean}"
			column1Label="#{messages['walletOperation.operationDate']}"
			column1="operationDate" column1Converter="date"
			column2Label="#{messages['walletOperation.endDate']}"
			column2="endDate" column3Label="#{messages['chargeInstance.code']}"
			column2Converter="date" column3="chargeInstance" column3Child="code"
			column4Label="#{messages['walletOperation.quantity']}"
			column4="quantity" column4Converter="4digits"
			column5Label="#{messages['walletOperation.amountWithoutTax']}"
			column5="amountWithoutTax" column5Converter="4digits"
			column6Label="#{messages['walletOperation.amountWithTax']}"
			column6="amountWithTax" column6Converter="4digits"
			column7Label="#{messages['currency.codeCurrency']}"
			column7="currency">
		</hftl:entityPopup>

		<!-- dataModel="#{getRatedTransactionsInvoiced}" -->
		<hftl:entityPopup id="ratedTransactionsInvoicedPopup"
			header="#{messages['ratedTransactionsInvoiced.popup.header']}"
			showSearchButton="false" backingBean="#{ratedTransactionBean}"
			column1Label="#{messages['ratedTransaction.usageDate']}"
			column1="usageDate"
			column2Label="#{messages['ratedTransaction.usageCode']}"
			column2="usageCode"
			column3Label="#{messages['ratedTransaction.description']}"
			column3="prDescription"
			column4Label="#{messages['ratedTransaction.usageQuantity']}"
			column4="usageQuantity"
			column5Label="#{messages['ratedTransaction.amount1WithoutTax']}"
			column5="amount"
			column6Label="#{messages['ratedTransaction.amount1WithTax']}"
			column6="amountWithTax">
		</hftl:entityPopup>

		<p:panelGrid styleClass="col2-set">
			<p:row>
				<p:column styleClass="col1">
					<hf:hierarchyPanel
						treeValue="#{customerTreeBean.buildAccountsHierarchy(userAccountBean.entity)}"
						entity="#{userAccountBean.entity}" />
				</p:column>
				<p:column styleClass="col2 tab-view-container">
					<hf:formPanel id="userAccountFormPanel"
						label="#{messages['userAccount.userAccountPanel']}"
						backingBean="#{userAccountBean}" killConversationOnSave="false"
						killConversationOnBack="false" useCustomIdParam="true">
						<p:tabView id="userAccountTab">
							<p:tab title="#{messages['billingAccount.tab.account']}">
								<hftl:panelGroup columns="1">
									<hf:formEntityField id="billingAccountSelectId"
										label="#{messages['userAccount.billingAccount']}"
										field="billingAccount" childField="code" required="true"
										popup="true" popupId="billingAccountPopup" />
								</hftl:panelGroup>
								<hftl:fieldset
									name="#{messages['userAccount.userAccountPanel']}" columns="1">
									<hftl:panelGroup columns="2">
										<!--Creation window fields-->
										<hf:formField label="#{messages['businessEntity.code']}"
											field="code" maxlength="35" validateUnique="true" size="35"
											required="true" />
										<hf:formEntityField
											label="#{messages['accountEntity.primaryContact']}"
											field="primaryContact" childField="code" popup="false"
											listBean="#{providerContactBean}" />
									</hftl:panelGroup>
									<hftl:panelGroup columns="1">
										<hf:formField
											label="#{messages['businessEntity.description']}"
											field="description" id="description" showOnlyOnNew="true"
											useConverter="false" size="70" maxlength="100" />
									</hftl:panelGroup>
									<!-- <hftl:panelGroup columns="2">
										<hf:formField
											label="#{messages['userAccount.subscriptionDate']}"
											field="subscriptionDate" showOnlyOnConsult="true" />
										<hf:formField
											label="#{messages['userAccount.terminationDate']}"
											field="terminationDate" showOnlyOnConsult="true" />
									</hftl:panelGroup>
									<hftl:panelGroup columns="2">
										<hf:formField label="#{messages['userAccount.status']}"
											field="status" childField="label" isMessage="true"
											disabled="true" />
										<hf:emtyFormField showOnlyOnNew="true" />
										<hf:formField label="#{messages['userAccount.statusDate']}"
											field="statusDate" showOnlyOnConsult="true" />
									</hftl:panelGroup> -->
									<hftl:panelGroup columns="1">
										<p:panelGrid columns="2">
											<p:outputLabel for="title_select"
												value="#{messages['name.title']}" />
											<p:selectOneMenu id="title_select"
												value="#{userAccountBean.entity.name.title}"
												rendered="#{userAccountBean.edit}"
												converter="omnifaces.SelectItemsConverter">
												<f:selectItem itemLabel="" itemValue="" />
												<f:selectItems value="#{titleBean.listAll()}" var="t"
													itemLabel="#{messages['Title.'.concat(t.code)]}" />
												<p:ajax event="valueChange"
													update=":userAccountFormPanel:formId:userAccountTab:userNamePanel :userAccountFormPanel:formId:userAccountTab:countryPanel" />
											</p:selectOneMenu>
											<h:outputText
												rendered="#{!userAccountBean.edit and userAccountBean.entity.name.title != null}"
												value="#{messages['Title.'.concat(userAccountBean.entity.name.title.code)]}"
												style="font-weight:bold;" />
										</p:panelGrid>
									</hftl:panelGroup>

									<h:panelGroup id="userNamePanel">
										<h:panelGrid columns="2" columnClasses="twoColGrid">
											<hf:formEntityField label="#{messages['name.lastName']}"
												field="name" childField="lastName" popup="false"
												maxlength="50" />
											<hf:formEntityField label="#{messages['name.firstName']}"
												field="name" childField="firstName" popup="false"
												show="#{userAccountBean.entity.name.title == null or !userAccountBean.entity.name.title.isCompany}"
												maxlength="50" />
											<hf:emtyFormField
												show="#{userAccountBean.entity.name.title == null or !userAccountBean.entity.name.title.isCompany}" />
										</h:panelGrid>
									</h:panelGroup>

									<hftl:panelGroup columns="1">
										<hf:formField
											label="#{messages['accountEntity.defaultLevel']}"
											field="defaultLevel" isMessage="true" />
									</hftl:panelGroup>
								</hftl:fieldset>
							</p:tab>
							<p:tab title="#{messages['billingAccount.tab.information']}">
								<hftl:fieldset name="#{messages['commons.contacts']}"
									columns="1">
									<hftl:panelGroup columns="1">
										<hf:formEntityField label="#{messages['address.address1']}"
											field="address" childField="address1" popup="false" size="80"
											maxlength="80" />
										<hf:formEntityField label="#{messages['address.address2']}"
											field="address" childField="address2" popup="false" size="80"
											maxlength="80" />
										<hf:formEntityField label="#{messages['address.address3']}"
											field="address" childField="address3" popup="false" size="80"
											maxlength="80" />
									</hftl:panelGroup>
									<hftl:panelGroup columns="2">
										<hf:formEntityField label="#{messages['address.zipCode']}"
											field="address" childField="zipCode" popup="false"
											maxlength="5" size="5" />
										<hf:formEntityField label="#{messages['address.city']}"
											field="address" childField="city" popup="false"
											maxlength="50" />
										<hf:formEntityField id="countryPanel"
											label="#{messages['address.country']}" embedded="true"
											field="address" childField="country"
											labelField="descriptionEn" valueField="countryCode"
											listBean="#{countryBean}"></hf:formEntityField>

									</hftl:panelGroup>
								</hftl:fieldset>
							</p:tab>

						</p:tabView>

					</hf:formPanel>

					<h:form id="operationsForm" rendered="#{!userAccountBean.edit}">
						<!-- 							<custom:listPanel label="#{messages['customerAccount.operations']}"> -->
						<div class="action-buttons">
							<p:button outcome="addNewSubscription"
								value="#{messages['userAccount.addNewSubscription']}"
								disabled="#{userAccountBean.entity.status.toString() != 'ACTIVE'}">
								<!-- 								<f:param name="cid" value="#{conversation.id}" /> -->
							</p:button>
							<p:commandButton value="#{messages['button.terminateButton']}"
								oncomplete="dlg_userAccountTerminationPopup.show()"
								disabled="#{userAccountBean.entity.status.toString() != 'ACTIVE'}" />
							<p:commandButton action="#{userAccountBean.cancelAccount()}"
								value="#{messages['button.cancelButton']}"
								onclick="if(confirm('#{messages['confirmationMessage.confirmCancellation']}')){return true;}else{return false;}"
								disabled="#{userAccountBean.entity.status.toString() != 'ACTIVE'}" />
							<p:commandButton action="#{userAccountBean.reactivateAccount()}"
								value="#{messages['button.reactivateButton']}"
								onclick="if(confirm('#{messages['confirmationMessage.confirmReactivation']}')){return true;}else{return false;}"
								disabled="#{userAccountBean.entity.status.toString() != 'TERMINATED' or userAccountBean.entity.status.toString()!='ACTIVE'}" />
							<p:commandButton type="button"
								value="#{messages['walletOperationPopup.button']}"
								onclick="dlg_walletOperationPopup.show();" />
							<!-- <p:commandButton type="button"
							value="#{messages['ratedTransactionInvoiced.button']}"
							onclick="dlg_ratedTransactionsInvoicedPopup.show();" /> -->
							<!-- 							</custom:listPanel> -->
						</div>
					</h:form>

				</p:column>
			</p:row>
		</p:panelGrid>

		<p:dialog id="userAccountTerminationPopup"
			header="#{messages['userAccount.accountTermination']}"
			widgetVar="dlg_userAccountTerminationPopup" dynamic="false"
			width="400">
			<hf:formPanel edit="true" backingBean="#{userAccountBean}"
				styleClass="formPanel" formId="termFrm" showFormButtons="false"
				killConversationOnSave="false" killConversationOnBack="false"
				useCustomIdParam="true">
				<p:panelGrid columns="1">
					<hf:formField label="#{messages['serviceInstance.code']}"
						field="code" size="50" edit="false" />
					<hf:formField
						label="#{messages['serviceInstance.terminationDate']}"
						field="terminationDate" required="true" edit="true" />
					<hf:formEntityField label="Motifs " field="terminationReason"
						childField="description" required="true" popup="false" edit="true"
						listElements="#{subscriptionTerminationReasonService.listReasons()}" />
					<p:panel styleClass="action-buttons">
						<p:commandButton action="#{userAccountBean.terminateAccount()}"
							value="#{messages['button.terminateButton']}" ajax="true"
							onsuccess="dlg_userAccountTerminationPopup.hide()"
							update=":#{p:component('operationsForm')} :userAccountFormPanel:formId:messages">
						</p:commandButton>
						<p:commandButton immediate="true"
							onclick="dlg_userAccountTerminationPopup.hide()"
							value="#{messages['management.close']}" />
					</p:panel>
				</p:panelGrid>
			</hf:formPanel>
		</p:dialog>

	</ui:define>

</ui:composition>
