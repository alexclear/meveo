<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	
	 xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="navigation">
		<ui:include src="/WEB-INF/layoutmenu.xhtml" />
	</ui:define>

	<ui:define name="body">

		<hftl:entityPopup id="searchCounterTemplatePopup"
			header="#{messages['counterTemplate.title']}"
			updateField=":webHookForm:formId:counterTemplateSelectedId"
			selection="#{webHookBean.entity.counterTemplate}"
			backingBean="#{counterTemplateBean}"
			searchField1Label="#{messages['businessEntity.code']}"
			searchField1="code" column1Label="#{messages['businessEntity.code']}"
			column1="code"
			column2Label="#{messages['businessEntity.description']}"
			column2="description"
			dataModel="#{counterTemplateBean.getLazyDataModel('NOTIFICATION')}">
		</hftl:entityPopup>
		<p:panel>
			<h:form id="crumbmenuForm">
				<p:breadCrumb homeDisplay="text" id="crumbmenu">
					<p:menuitem value="#{messages['menu.reporting']}" disabled="true" />
					<p:menuitem outcome="webHooks"
						value="#{messages['menu.webHooks']}" />
				</p:breadCrumb>
			</h:form>
		</p:panel>
		<hf:formPanel id="webHookForm" label="#{messages['menu.webHook']}"
			backingBean="#{webHookBean}" columns="4" showEnableDisableButton="true">

			<hf:formField label="#{messages['entity.code']}" field="code"
				required="true" maxLength="60" />
			<hf:formField
				label="#{messages['entity.notification.classNameFilter']}"
				field="classNameFilter" required="true" size="60" maxlength="255" 
                autocompleteMethod="#{notificationBean.autocompleteClassNames}" isAutocomplete="true"/>
			<hf:formField
				label="#{messages['entity.notification.eventTypeFilter']}"
				field="eventTypeFilter" required="true" />
			<hf:formField label="#{messages['entity.notification.elFilter']}"
				field="elFilter" textArea="true" maxlength="1000" componentWidth="50" newLine="true"/>
			<hf:formField label="#{messages['entity.notification.elAction']}"
				field="elAction" textArea="true" maxlength="2000" componentWidth="50"/>

			<hf:formField label="#{messages['entity.webHook.host']}" field="host"
				required="true" size="100" maxlength="255" />
			<hf:formField label="#{messages['entity.webHook.port']}" field="port" maxValue="65535"/>
			<hf:formField label="#{messages['entity.webHook.page']}" field="page"
				size="100" maxlength="255" required="true" />
			<hf:formField label="#{messages['entity.webHook.httpMethod']}"
				field="httpMethod" required="true" />
			<hf:formField label="#{messages['entity.webHook.username']}"
				field="username" size="40" maxlength="255" newLine="true"/>
			<hf:formField label="#{messages['entity.webHook.password']}"
				field="password" size="40" maxlength="255" />

			<hf:formField label="#{messages['entity.webHook.headers']}"
				field="headers" componentWidth="100" />
			<hf:formField label="#{messages['entity.webHook.params']}"
				field="params" componentWidth="100"/>

			<hf:formField id="counterTemplateSelectedId"
				label="#{messages['counterTemplate.title']}" field="counterTemplate"
				valueLabelField="code" popup="true" popupId="searchCounterTemplatePopup"
				clearButton="true" required="false" />
                
            <hf:formField label="#{messages['enableEntity.disabled']}" doNotShowOnNew="true" allowEdit="false"
                field="disabled" isMessage="true" />
		</hf:formPanel>

		<p:panel rendered="#{not empty webHookBean.entity.id}">
			<hftl:dataList backingBean="#{notificationHistoryBean}" checkMany="false"
				dataModel="#{notificationHistoryBean.getLazyDataModel(webHookBean.entity.id)}">
				<hftl:column label="#{messages['commons.date']}" field="auditable.updated" isDate="true" time="true" />
				<hftl:column
					label="#{messages['entity.notification.notificationType']}"
					field="entityClassName" />
				<hftl:column label="#{messages['entity.notification']}"
					field="notification.code" />
				<hftl:column label="#{messages['entity.notification.retryNr']}"
					field="nbRetry" />
				<hftl:column label="#{messages['entity.notification.result']}"
					field="result" />
				<p:column
					headerText="#{messages['entity.notification.inboundRequest']}">
					<h:link value="#{entity.inboundRequest.code}"
						outcome="inboundRequestDetail"
						rendered="#{entity.inboundRequest != null}">
						<f:param name="objectId" value="#{entity.inboundRequest.id}" />
					</h:link>
				</p:column>
				<hftl:column label="#{messages['commons.status']}" field="status.label" isMessage="true" />
			</hftl:dataList>
		</p:panel>

	</ui:define>

</ui:composition>
