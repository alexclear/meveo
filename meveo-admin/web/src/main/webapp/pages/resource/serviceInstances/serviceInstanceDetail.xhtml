<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:hftl="http://hftl.org"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	template="/WEB-INF/template.xhtml" xmlns:p="http://primefaces.org/ui">

	<ui:define name="metadata">
		<f:metadata>            
			<f:viewParam name="serviceInstanceId"
				value="#{serviceInstanceBean.objectId}"></f:viewParam>
			<f:viewParam name="subscriptionId"
				value="#{subscriptionBean.objectId}" />
<!--             <f:viewParam name="backView"/> -->
		</f:metadata>
	</ui:define>

	<ui:define name="navigation">
		<ui:include src="/WEB-INF/layoutmenu.xhtml" />
	</ui:define>

	<ui:define name="body">
		<p:panel>
			<h:form id="crumbmenuForm">
				<p:breadCrumb homeDisplay="text" id="crumbmenu">
					<p:menuitem value="#{messages['menu.crm']}" disabled="true" />
					<p:menuitem outcome="subscriptions"
						value="#{messages['menu.subscriptions']}" />
				</p:breadCrumb>
			</h:form>
		</p:panel>
		<hftl:entityPopup id="serviceTemplatePopup"
			header="#{messages['serviceTemplate.popup.header']}"
			backingBean="#{serviceTemplateBean}"
			searchField1Label="#{messages['serviceTemplate.code']}"
			searchField1="code"
			searchField2Label="#{messages['serviceTemplate.description']}"
			searchField2="description"
			column1Label="#{messages['serviceTemplate.code']}" column1="code"
			column2Label="#{messages['serviceTemplate.description']}"
			column2="description"
			selection="#{serviceInstanceBean.entity.serviceTemplate}"
            updateField=":formPanel:formId:serviceSelectedId">
		</hftl:entityPopup>

		<hftl:entityPopup id="subscriptionPopup"
			header="#{messages['subscription.popup.header']}"
			backingBean="#{subscriptionBean}"
			searchField1Label="#{messages['subscription.code']}"
			searchField1="code"
			searchField2Label="#{messages['subscription.description']}"
			searchField2="description"
			column1Label="#{messages['subscription.code']}" column1="code"
			column2Label="#{messages['subscription.description']}"
			column2="description"
			selection="#{serviceInstanceBean.entity.subscription}"
            updateField=":formPanel:formId:subscriptionSelectedId">
		</hftl:entityPopup>

		<hf:formPanel label="#{messages['serviceInstance.panel']}" id="formPanel" killConversationOnBack="false" killConversationOnSave="false"
			backingBean="#{serviceInstanceBean}" columns="2" objectIdParamName="serviceInstanceId"  showDeleteButton="#{serviceInstanceBean.entity.status eq 'INACTIVE'}" >

			<hf:formField id="serviceSelectedId"
				label="#{messages['serviceInstance.code']}" field="serviceTemplate"
				valueLabelField="code" required="true" popup="true"
				popupId="serviceTemplatePopup" allowEdit="false"/>

			<hf:formField id="subscriptionSelectedId"
				label="#{messages['serviceInstance.subscription']}"
				field="subscription" valueLabelField="code" required="true" popup="true"
				popupId="subscriptionPopup" allowEdit="false"/>

			<hf:formField label="#{messages['serviceInstance.description']}"
				field="description" size="40" maxlength="50"
				allowEdit="false" />
			<hf:formField label="#{messages['serviceInstance.status']}"
				field="status" allowEdit="false"/>
			<hf:formField label="#{messages['serviceInstance.statusDate']}"
				field="statusDate" allowEdit="false"/>
			<hf:formField label="#{messages['serviceInstance.subscriptionDate']}"
				field="subscriptionDate"
				allowEdit="#{serviceInstanceBean.entity.status eq 'INACTIVE'}" />
			<hf:formField label="#{messages['serviceInstance.endAgrementDate']}"
				field="endAgrementDate" />
			<hf:formField
				label="#{messages[serviceInstanceBean.entity.status=='SUSPENDED'?'serviceInstance.suspensionDate':'serviceInstance.terminationDate']}"
				field="terminationDate" allowEdit="false"/>
			<hf:formField label="#{messages['serviceInstance.quantity']}"
				field="quantity" allowEdit="#{serviceInstanceBean.entity.status eq 'INACTIVE'}" />
			<hf:formField
				label="#{messages['serviceInstance.terminationReason']}" allowEdit="false"
				field="subscriptionTerminationReason" valueLabelField="description"
				rendered="#{not empty serviceInstanceBean.entity.subscriptionTerminationReason}" />
		</hf:formPanel>

		<h:form id="operationsForm" rendered="#{not empty serviceInstanceBean.entity.id}">
			<p:commandButton action="#{serviceInstanceBean.activateService}"
				value="#{messages['button.activateButton']}" ajax="false"
				onclick="if(confirm('#{messages['confirmationMessage.confirmActivation']}')){return true;}else{return false;}"
				disabled="#{serviceInstanceBean.entity.status.toString() == 'ACTIVE' or serviceInstanceBean.entity.status.toString() == 'TERMINATED'}" />
			<p:commandButton action="#{serviceInstanceBean.cancelService}"
				value="#{messages['button.cancelButton']}" ajax="false"
				onclick="if(confirm('#{messages['confirmationMessage.confirmCancellation']}')){return true;}else{return false;}"
				disabled="#{serviceInstanceBean.entity.status.toString() != 'ACTIVE'}" />
			<p:commandButton action="#{serviceInstanceBean.suspendService}"
				value="#{messages['button.suspendButton']}" ajax="false"
				onclick="if(confirm('#{messages['confirmationMessage.confirmSuspension']}')){return true;}else{return false;}"
				disabled="#{serviceInstanceBean.entity.status.toString() != 'ACTIVE'}" />
		</h:form>

	</ui:define>

</ui:composition>
