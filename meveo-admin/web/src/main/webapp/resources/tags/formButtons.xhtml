
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	xmlns:cc="http://java.sun.com/jsf/composite">

<!--
    Makes part of "happy faces" component group.
    A custom component to display default data entry and navigation related buttons in a formPanel.
    
    Must be located inside a formPanel component.   
 
    Attributes
        edit - edit or view mode
        ajaxSubmit - should create/update form submit be done in ajax way
        submitPartialProcess - items to process during ajax submit
        submitPartialSubmitFilter - items to filter during ajax submit
        submitUpdate - items to update after ajax submit
        killConversationOnSave - should conversation be killed uppon saving
        killConversationOnBack - should conversation be killed uppon navigating back
        showBackButton - show a default "navigate back" button
        showEditButton - show a default "edit" button
        showEnableDisableButton - show a default "enable/disable" button
        useCustomIdParam and objectIdParamName - should a custom parameter id instead of a default "objectId" be used for navigation
        updateConfirmationMessage - if not empty, update will show a confirmation dialog with this message  
        
-->


<cc:interface>
	<cc:attribute name="backingBean" required="true"
		type="org.meveo.admin.action.BaseBean" />
	<cc:attribute name="edit" required="true" />
	<cc:attribute name="killConversationOnSave" default="true" />
	<cc:attribute name="killConversationOnBack" default="true" />
	<cc:attribute name="showBackButton" default="true" />
    <cc:attribute name="showEditButton" default="true" />
    <cc:attribute name="showEnableDisableButton" default="false" />
    <cc:attribute name="showDeleteButton" default="true"/>
	<cc:attribute name="useCustomIdParam" default="false" />
	<cc:attribute name="objectIdParamName"
		default="#{cc.attrs.useCustomIdParam?cc.attrs.backingBean.idParameterName:'objectId'}" />
	<cc:attribute name="updateConfirmationMessage" default="" />
    <cc:attribute name="ajaxSubmit" required="true" />
    <cc:attribute name="submitPartialProcess" />
    <cc:attribute name="submitPartialSubmitFilter" default=":not([name*='omitFromSubmit'])"/> <!--  instead of partial submit filter, jquery expression could be used in process attribute:  process="@this @( :input:not([name*='omitFromSubmit']))" -->
    <cc:attribute name="submitUpdate" default="@all"/>
</cc:interface>

<cc:implementation>

	<h:panelGroup layout="block" styleClass="form-panel-actions">
		<p:button value="#{messages['commons.edit']}" includeViewParams="true"
			rendered="#{!cc.attrs.edit and cc.attrs.showEditButton}">
			<f:param name="edit" value="true" />
 			<f:param name="#{cc.attrs.objectIdParamName}"
 				value="#{cc.attrs.backingBean.objectId}" />
 			<f:param name="cid"
 				value="#{javax.enterprise.context.conversation.id}" />
			<c:if test="#{not empty cc.attrs.backingBean.backView}">
				<f:param name="backView" value="#{cc.attrs.backingBean.backView}"/>
			</c:if>
		</p:button>

        <p:commandButton value="#{messages['commons.disable']}"
            rendered="#{not empty cc.attrs.backingBean.objectId and cc.attrs.showEnableDisableButton and cc.attrs.backingBean.entity.active}"
            action="#{cc.attrs.backingBean.disable}" update="@form"/>
            
        <p:commandButton value="#{messages['commons.enable']}"
            rendered="#{not empty cc.attrs.backingBean.objectId and cc.attrs.showEnableDisableButton and cc.attrs.backingBean.entity.disabled}"
            action="#{cc.attrs.backingBean.enable}" update="@form"/>

		<p:commandButton id="saveButton"
			rendered="#{cc.attrs.edit and empty(cc.attrs.updateConfirmationMessage) and !cc.attrs.ajaxSubmit}"
			value="#{messages['action.save']}"
			action="#{cc.attrs.backingBean.saveOrUpdate(cc.attrs.killConversationOnSave)}"
			icon="ui-icon-check" ajax="false">
			<f:param name="edit" value="#{cc.attrs.edit}" />
		</p:commandButton>

        <p:commandButton id="saveButtonAjax"
            rendered="#{cc.attrs.edit and empty(cc.attrs.updateConfirmationMessage) and cc.attrs.ajaxSubmit}"
            value="#{messages['action.save']} " oncomplete="$('html,body').scrollTop(0);"
            action="#{cc.attrs.backingBean.saveOrUpdate(cc.attrs.killConversationOnSave)}"
            icon="ui-icon-check" process="@this #{cc.attrs.submitPartialProcess!=null?cc.attrs.submitPartialProcess:'@form'}" partialSubmit="#{cc.attrs.submitPartialProcess !=null}" partialSubmitFilter="#{cc.attrs.submitPartialSubmitFilter}" update="#{cc.attrs.submitUpdate}">
            <f:param name="edit" value="#{cc.attrs.edit}" />
        </p:commandButton>

		<!-- Update with message -->
		<p:remoteCommand id="remoteUpdateWithMessageButton" rendered="#{cc.attrs.submitPartialProcess==null}"
			action="#{cc.attrs.backingBean.saveOrUpdateWithMessage(cc.attrs.killConversationOnSave)}"
			name="updateWithMessage" oncomplete="handleUpdateWithMessageComplete(xhr,status,args)" />
            
        <!-- Update with message with partial submit -->
        <p:remoteCommand id="remoteUpdateWithMessageButtonPartialSubmit" rendered="#{cc.attrs.submitPartialProcess!=null}"
            action="#{cc.attrs.backingBean.saveOrUpdateWithMessage(cc.attrs.killConversationOnSave)}"
            process="@this #{cc.attrs.submitPartialProcess}" partialSubmit="true" partialSubmitFilter="#{cc.attrs.submitPartialSubmitFilter}" 
            update="#{cc.attrs.submitUpdate}" name="updateWithMessagePartialSubmit" oncomplete="handleUpdateWithMessageComplete(xhr,status,args)" />            
            
		<p:commandButton id="#{resultsId}saveButtonWithMessage"
			rendered="#{cc.attrs.edit and !empty(cc.attrs.backingBean.objectId) and !empty(cc.attrs.updateConfirmationMessage)}"
			value="#{messages['action.save']}" icon="ui-icon-check"
			oncomplete="PF('saveButtonWithMessageDialog').show()">
		</p:commandButton>
        
		<!-- Update the message handling when  -->
		<p:confirmDialog id="confirmUpdateWithMessage" appendTo="@(body)"
			widgetVar="saveButtonWithMessageDialog" showEffect="fade"
			hideEffect="fade" severity="alert"
			message="#{(cc.attrs.updateConfirmationMessage eq '') ? messages['confirmationMessage.confirmUpdate'] : cc.attrs.updateConfirmationMessage}">
			<p:commandButton id="updateOk" value="#{messages['commons.yes']}" rendered="#{cc.attrs.submitPartialProcess==null}"
				styleClass="ui-confirmdialog-yes" icon="ui-icon-check"
				oncomplete="updateWithMessage()"
				onclick="PF('saveButtonWithMessageDialog').hide()">
				<f:param name="edit" value="#{cc.attrs.edit}" />
			</p:commandButton>
            
            <p:commandButton id="updateOkPartialSubmit" value="#{messages['commons.yes']}" rendered="#{cc.attrs.submitPartialProcess!=null}"
                styleClass="ui-confirmdialog-yes" icon="ui-icon-check"
                oncomplete="updateWithMessagePartialSubmit()"
                onclick="PF('saveButtonWithMessageDialog').hide()">
                <f:param name="edit" value="#{cc.attrs.edit}" />
            </p:commandButton>            

            <p:commandButton id="updateKO" value="#{messages['commons.no']}"
				type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"
				onclick="PF('saveButtonWithMessageDialog').hide()" />
		</p:confirmDialog>
		<!-- Update with message -->

		<cc:insertChildren />

		<hf:clearButton id="resetButton" label="#{messages['action.reset']}"
			edit="#{cc.attrs.edit}"
			resetAction="#{cc.attrs.backingBean.resetFormEntity()}" includeViewParams="true"/>

		<p:button id="backButton" value="#{messages['action.back']}"
			rendered="#{cc.attrs.showBackButton}"
			outcome="#{cc.attrs.backingBean.back()}" includeViewParams="true">

			<c:if
				test="#{conversation.id != null and not cc.attrs.killConversationOnBack}">
				<f:param name="cid"
					value="#{javax.enterprise.context.conversation.id}" />
			</c:if>
		</p:button>
		<script type="text/javascript">
			//<![CDATA[
				function handleDeleteComplete(xhr, status, args) {
					var result = args.result;
					if(typeof(result)!="undefined" && !result){
						
					}
				}

				function handleUpdateWithMessageComplete(xhr, status, args) {
					var result = args.result;
					if(typeof(result)!="undefined" && !result){
						PF('confirmCannotUpdateWithMessageDialog').show();
					}
				}
			//]]>
		</script>	
		<p:remoteCommand id="remoteDeleteButton" action="#{cc.attrs.backingBean.deleteWithBack}" name="doDelete" oncomplete="handleDeleteComplete(xhr,status,args)" />
		<p:commandButton id="#{resultsId}deletelink" icon="ui-icon-trash" value="#{messages['commons.delete']}"
			oncomplete="PF('confirmDeleteWidget').show()" rendered="#{cc.attrs.showDeleteButton and cc.attrs.backingBean.entity.id!=null}">
			<f:setPropertyActionListener target="#{cc.attrs.backingBean.entity}"
				value="#{entity}"></f:setPropertyActionListener>
		</p:commandButton>
		<p:confirmDialog id="confirmDeleteDialog" styleClass="confirm-dialog"
			message="#{messages['commons.confirmDelete']}" header=""
			severity="alert" widgetVar="confirmDeleteWidget" appendTo="@(body)">
			<p:panel styleClass="confirm-dialog-content">
				<p:commandButton id="deleteOk" value="#{messages['commons.yes']}"
					oncomplete="doDelete()" onclick="PF('confirmDeleteWidget').hide()"/>
				<p:commandButton id="deleteKo" value="#{messages['commons.no']}"
					onclick="PF('confirmDeleteWidget').hide()" type="button" />
			</p:panel>
		</p:confirmDialog>
		<p:confirmDialog id="confirmCanDeleteDialog" styleClass="confirm-dialog"
			message="#{messages['commons.confirmCanotDelete']}" header=""
			severity="alert" widgetVar="confirmCanotDeleteWidget" appendTo="@(body)">
			<p:panel styleClass="confirm-dialog-content">
				<p:commandButton id="canotdeleteOk" value="#{messages['commons.ok']}"
					oncomplete="PF('confirmCanotDeleteWidget').hide()" update="@this" />
			</p:panel>
		</p:confirmDialog>
		<p:confirmDialog id="confirmCannotUpdateWithMessageDialog" styleClass="confirm-dialog"
			message="#{messages['message.confirm.cannotUpdate']}" header=""
			severity="alert" widgetVar="confirmCannotUpdateWithMessageDialog" appendTo="@(body)">
			<p:panel styleClass="confirm-dialog-content">
				<p:commandButton id="cannotUpdateWithMessage" value="#{messages['commons.ok']}"
					oncomplete="PF('confirmCannotUpdateWithMessageDialog').hide()" update="@this" />
			</p:panel>
		</p:confirmDialog>

	</h:panelGroup>

</cc:implementation>

</html>
