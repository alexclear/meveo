<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:hftl="http://hftl.org" 
	xmlns:p="http://primefaces.org/ui"
	xmlns:hf="http://java.sun.com/jsf/composite/tags"
	template="/layout/template.xhtml">

	<ui:define name="navigation">
		<ui:include src="/layout/navigation.xhtml" />
	</ui:define>

	<ui:define name="body">
		

		<hf:formPanel label="#{messages['invoice.panel']}" backingBean="#{invoiceBean}" showFormButtons="false">
		   <hftl:fieldset name="#{messages['invoice.header']}"> 
			<p:panelGrid columns="3">
				<hf:formEntityField label="#{messages['invoice.billingAccount']}" field="billingAccount" childField="code" popup="false" popupId="searchBillingAccountPopup" clearButton="true" />
    			<hf:formField label="#{messages['invoice.invoiceNumber']}" field="invoiceNumber" validateUnique="true"/>
    			<hf:formField label="#{messages['invoice.invoiceDate']}" field="invoiceDate" />
    		</p:panelGrid>	
    		<p:panelGrid columns="4">
    			<hf:formField label="#{messages['invoice.dueDate']}" field="dueDate" />	
    			<hf:formField label="#{messages['invoice.discount']}" field="discount" />
				<hf:formField label="#{messages['invoice.iban']}" field="iban" />
    			<hf:formField label="#{messages['invoice.alias']}" field="alias" />
    		</p:panelGrid>			
    			<hf:formField label="#{messages['invoice.comment']}" field="comment" textArea="true"/>
	      </hftl:fieldset> 
			    
			 </hf:formPanel>  
			   
			 <h:form id="form"> 
			 <hftl:fieldset name="#{messages['invoice.details']}">
				 <p:dataTable id="catTable" var="cat" value="#{invoiceBean.invoiceCategories}" style="width:600px">  
				  
						<p:columnGroup type="header">  
							<p:row>  
								<p:column rowspan="2" headerText="#{messages['invoice.cat.subcat']}" />  
							</p:row>  
							<p:row>  
								<p:column headerText="#{messages['invoice.amountWithoutTax']}" />   
							</p:row>  
						</p:columnGroup>  
				  
						<p:subTable var="subCat" value="#{cat.invoiceSubCategoryDTOList}">  
							<f:facet name="header">  
							  #{cat.description}   
							</f:facet>  
							<p:column>  
								#{subCat.description}  
							</p:column>  
							<p:column>  
								#{subCat.amountWithoutTax}  
							</p:column>  
						</p:subTable>  
					</p:dataTable> 
				</hftl:fieldset> 	
			 </h:form>  
			   
		<hf:formPanel backingBean="#{invoiceBean}" showFormButtons="false"> 
				<hftl:fieldset name="#{messages['invoice.totals']}">
				   <hf:formField label="#{messages['invoice.amountWithoutTax']}" field="amountWithoutTax" />
					<hf:formField label="#{messages['invoice.amountTax']}" field="amountTax" />
					<hf:formField label="#{messages['invoice.amountWithTax']}" field="amountWithTax" />
					<p:panelGrid columns="3">
					<p:outputLabel for="netTopayId" value="#{messages['invoice.netToPay']}" />
					<h:outputText id="netTopayId" value="#{invoiceBean.netToPay}" styleClass="field-value" /> 
					</p:panelGrid>
				</hftl:fieldset> 
				<br/>
				<br/>
    			<hf:formField label="#{messages['invoice.paymentMethod']}" field="paymentMethod" childField="label" isMessage="true" />
				
    			<p:panelGrid columns="2" rendered="#{billingAccountBean.pdfExists(invoiceBean.entity.id)}">
			    <h:outputText value="#{messages['invoice.file']}" styleClass="field-value" /> 
			    <h:commandLink action="#{billingAccountBean.generatePDF(invoiceBean.entity.id)}">
    			<h:graphicImage value="/img/pdf.gif" style="border:0"/>
    			</h:commandLink>
			    </p:panelGrid>
    			
				<p:button outcome="billingAccountDetail" value="#{messages['action.back']}">
				<f:param name="billingAccountId" value="#{invoiceBean.entity.getBillingAccount().getId}" /> 
			    <f:param name="edit" value="false" />
				<f:param name="cid" value="#{javax.enterprise.context.conversation.id}" />
				</p:button>
				
			</hf:formPanel>
			
				
    			
				
		

	</ui:define>

</ui:composition>
