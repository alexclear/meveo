<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd">

	<changeSet id="#1803_20160628" author="TonyAlejandro">
        <createTable tableName="ADM_SECURED_ENTITY">
   			<column name="user_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="code" type="VARCHAR(60)">
				<constraints nullable="false" />
			</column>
			<column name="entity_class" type="VARCHAR(255)" />
		</createTable>

		<addNotNullConstraint tableName="ADM_SECURED_ENTITY" columnName="user_id" />
        <addNotNullConstraint tableName="ADM_SECURED_ENTITY" columnName="code" />
        <addNotNullConstraint tableName="ADM_SECURED_ENTITY" columnName="entity_class" />
		<addForeignKeyConstraint
        	constraintName="FK_SECURED_ENTITY_USER" 
        	referencedTableName="ADM_USER" 
        	baseColumnNames="USER_ID" 
        	baseTableName="ADM_SECURED_ENTITY"
            referencedColumnNames="ID" />
	</changeSet>
	
	<changeSet id="#1821_20160707" author="EdwardLegaspi">
		<addColumn tableName="cat_offer_template">
			<column name="valid_from" type="TIMESTAMP WITHOUT TIME ZONE"></column>
			<column name="valid_to" type="TIMESTAMP WITHOUT TIME ZONE"></column>
		</addColumn>
		<addColumn tableName="cat_offer_serv_templates">
			<column name="valid_from" type="TIMESTAMP WITHOUT TIME ZONE"></column>
			<column name="valid_to" type="TIMESTAMP WITHOUT TIME ZONE"></column>
		</addColumn>
	</changeSet>
	
	<changeSet id="#1821_20160711" author="EdwardLegaspi">
		<addColumn tableName="cat_offer_template">
			<column name="image_content_type" type="VARCHAR(50)" />
		</addColumn>
	</changeSet>	
<changeSet id="#1774_20160725" author="smichea">
		<addColumn tableName="cat_price_plan_matrix">
			<column name="script_instance_id" type="BIGINT" />
        </addColumn>
		<addForeignKeyConstraint baseColumnNames="script_instance_id"
			baseTableName="cat_price_plan_matrix" constraintName="fk_priceplan_script"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="meveo_script_instance" />
	</changeSet>  
	<changeSet id="#1889_20160729" author="Mbarek">
	    <addColumn tableName="BILLING_TAX">
        <column name="UUID" type="VARCHAR(60)"/>
		</addColumn>
	</changeSet>
     <changeSet id="#1890_20160801" author="Mbarek">
	      <addColumn tableName="BILLING_CYCLE">
          <column name="UUID" type="VARCHAR(60)"/>
		</addColumn>
		<addColumn tableName="BILLING_INVOICE_CONFIGURATION">
			<column name="DISPLAY_BILLING_CYCLE" type="BOOL" defaultValueBoolean="false"></column> 
		</addColumn>
	</changeSet>
	
      <changeSet id="#1890_#1889_UIID_20160801" author="Mbarek">
         <sql>update BILLING_TAX set UUID ='TAX-'|| id </sql>   
        <sql>update BILLING_CYCLE set UUID ='BillingCycle-'|| id </sql> 
    </changeSet>  	

    <changeSet author="anasseh (generated)" id="#1841_13072016-1">
        <createSequence sequenceName="wf_action_seq"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-2">
        <createSequence sequenceName="wf_transition_seq"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-3">
        <createSequence sequenceName="wf_workflow_seq"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-4">
        <createTable tableName="wf_action">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT4"/>
            <column name="disabled" type="BOOL">
                <constraints nullable="false"/>
            </column>
            <column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="updated" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="action_el" type="VARCHAR(2000)"/>
            <column name="condition_el" type="VARCHAR(2000)"/>
            <column name="priority" type="INT4"/>
            <column name="provider_id" type="BIGINT"/>
            <column name="creator_id" type="BIGINT"/>
            <column name="updater_id" type="BIGINT"/>
            <column name="wf_transition_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-5">
        <createTable tableName="wf_transition">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT4"/>
            <column name="disabled" type="BOOL">
                <constraints nullable="false"/>
            </column>
            <column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="updated" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="condition_el" type="VARCHAR(2000)"/>
            <column name="from_status" type="VARCHAR(255)"/>
            <column name="to_status" type="VARCHAR(255)"/>
            <column name="provider_id" type="BIGINT"/>
            <column name="creator_id" type="BIGINT"/>
            <column name="updater_id" type="BIGINT"/>
            <column name="workflow_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-6">
        <createTable tableName="wf_workflow">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT4"/>
            <column name="disabled" type="BOOL">
                <constraints nullable="false"/>
            </column>
            <column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="updated" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="code" type="VARCHAR(60)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(100)"/>
            <column name="enable_hostory" type="BOOL"/>
            <column name="export_lot" type="BOOL"/>
            <column name="status" type="VARCHAR(255)"/>
            <column name="wf_type" type="VARCHAR(255)"/>
            <column name="provider_id" type="BIGINT"/>
            <column name="creator_id" type="BIGINT"/>
            <column name="updater_id" type="BIGINT"/>
        </createTable>
    </changeSet>

   <changeSet author="anasseh (generated)" id="#1841_13072016-165">
        <dropForeignKeyConstraint  baseTableName="ar_action_dunning" constraintName="fk_r8q3phft4xgm8lbfu6i7lo3kx" />
    </changeSet>   
    
    <changeSet author="anasseh (generated)" id="#1841_13072016-18">
        <addPrimaryKey columnNames="id" constraintName="wf_action_pkey" tableName="wf_action"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-19">
        <addPrimaryKey columnNames="id" constraintName="wf_transition_pkey" tableName="wf_transition"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-20">
        <addPrimaryKey columnNames="id" constraintName="wf_workflow_pkey" tableName="wf_workflow"/>
    </changeSet>
 
    <changeSet author="anasseh (generated)" id="#1841_13072016-23">
        <addUniqueConstraint columnNames="from_status, to_status, workflow_id, provider_id" constraintName="uk_7xdivt2yngk5mmjfdy2x73cad" deferrable="false" disabled="false" initiallyDeferred="false" tableName="wf_transition"/>
    </changeSet>

    <changeSet author="anasseh (generated)" id="#1841_13072016-25">
        <addUniqueConstraint columnNames="priority, wf_transition_id, provider_id" constraintName="uk_cr97e5dxkl6ps0coltjw6i28y" deferrable="false" disabled="false" initiallyDeferred="false" tableName="wf_action"/>
    </changeSet>

    <changeSet author="anasseh (generated)" id="#1841_13072016-27">
        <addUniqueConstraint columnNames="provider_id, code" constraintName="uk_j8v4x5olh5um1g7y5vnsayrka" deferrable="false" disabled="false" initiallyDeferred="false" tableName="wf_workflow"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-31">
        <addForeignKeyConstraint baseColumnNames="provider_id" baseTableName="wf_workflow" constraintName="fk_30dgqb4bqjvftqov1dmjetr56" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-32">
        <addForeignKeyConstraint baseColumnNames="updater_id" baseTableName="wf_workflow" constraintName="fk_59d2mctermakats2qqmqnt0p" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-35">
        <addForeignKeyConstraint baseColumnNames="workflow_id" baseTableName="wf_transition" constraintName="fk_6wxr8klsgmr7ko8lpg0ftvtpy" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="wf_workflow"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-36">
        <addForeignKeyConstraint baseColumnNames="provider_id" baseTableName="wf_transition" constraintName="fk_79r4px1y8ue4cphslp2j35y65" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-40">
        <addForeignKeyConstraint baseColumnNames="creator_id" baseTableName="wf_transition" constraintName="fk_83p4dgib7kijghh3w89ero3ep" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-45">
        <addForeignKeyConstraint baseColumnNames="wf_transition_id" baseTableName="wf_action" constraintName="fk_bh5loyx0bx3tm8yu3ul2ycco0" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="wf_transition"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-48">
        <addForeignKeyConstraint baseColumnNames="updater_id" baseTableName="wf_action" constraintName="fk_do5fekc1wyiqn59lbedxeppyr" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-55">
        <addForeignKeyConstraint baseColumnNames="creator_id" baseTableName="wf_action" constraintName="fk_il9g2ryuq1wxbct7bler61t02" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-56">
        <addForeignKeyConstraint baseColumnNames="creator_id" baseTableName="wf_workflow" constraintName="fk_jjfi7wwmfajc14c0ji4pp9tmc" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-57">
        <addForeignKeyConstraint baseColumnNames="updater_id" baseTableName="wf_transition" constraintName="fk_lk8axoo3cfhip52gnv02mn9eu" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-61">
        <addForeignKeyConstraint baseColumnNames="provider_id" baseTableName="wf_action" constraintName="fk_q7dvcjiuap29yhvq884lt0die" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-63">
        <dropForeignKeyConstraint baseTableName="ar_dunning_plan" constraintName="fk_24c5wf8u9a35yf8uutjf5qwwf"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-64">
        <dropForeignKeyConstraint baseTableName="ar_dunning_plan" constraintName="fk_3nhld7nla1pv1t8eejdl4dn6p"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-69">
        <dropForeignKeyConstraint baseTableName="ar_action_plan_item" constraintName="fk_78p10vstesm3xr605s46qn3gq"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-70">
        <dropForeignKeyConstraint baseTableName="ar_action_plan_item" constraintName="fk_8q1jrqq9e8xru7m27nbwrxp3k"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-72">
        <dropForeignKeyConstraint baseTableName="ar_dunning_plan" constraintName="fk_ar_credit_category_ar_dunning_plan"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-80">
        <dropForeignKeyConstraint baseTableName="ar_dunning_plan_transition" constraintName="fk_ecur7dwit9crb6cbhlubxs3jn"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-81">
        <dropForeignKeyConstraint baseTableName="ar_dunning_plan_transition" constraintName="fk_eu7ekseo196cq1qgyg7xm7vs5"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-82">
        <dropForeignKeyConstraint baseTableName="ar_dunning_plan_transition" constraintName="fk_gc1m3d2m0dsqcaek8rxrk0u87"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-84">
        <dropForeignKeyConstraint baseTableName="ar_dunning_plan" constraintName="fk_j0vlitgsqwnnkry67xwuead15"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-86">
        <dropForeignKeyConstraint baseTableName="ar_dunning_plan_transition" constraintName="fk_jpipfg980fcv7pq4s9tnb35ik"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-87">
        <dropForeignKeyConstraint baseTableName="ar_action_plan_item" constraintName="fk_k9j7i31wmyhrw11lyxkdnpymr"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-95">
        <dropForeignKeyConstraint baseTableName="ar_action_plan_item" constraintName="fk_n5ax6w0qt9pum3oc3n2b3hgxw"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-101">
        <dropUniqueConstraint constraintName="uk_ewwxy8ieo179rif5ud8hduqkt" tableName="ar_dunning_plan_transition"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-103">
        <dropUniqueConstraint constraintName="uk_qn6vfgeg5g2y4pb9y6qb8ogjo" tableName="ar_dunning_plan"/>
    </changeSet>   
    <changeSet author="anasseh (generated)" id="#1841_13072016-104">
        <dropTable tableName="ar_action_plan_item"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-105">
        <dropTable tableName="ar_dunning_plan"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-106">
        <dropTable tableName="ar_dunning_plan_transition"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-144">
        <dropSequence sequenceName="ar_dunning_plan_seq"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-145">
        <dropSequence sequenceName="ar_dunning_plan_transition_seq"/>
    </changeSet>
    <changeSet author="anasseh (generated)" id="#1841_13072016-164">       
        <addForeignKeyConstraint baseColumnNames="action_plan_item_id" baseTableName="ar_action_dunning" constraintName="fk_r8q3phft4xgm8lbfu6i7lo3kx" referencedColumnNames="id" referencedTableName="wf_action"/>
    </changeSet>	
    <changeSet id="#1885_20160815_service_entity" author="EdwardPLegaspi">
    	<addColumn tableName="cat_service_template">
    		<column name="image" type="oid" />
			<column name="image_content_type" type="VARCHAR(50)" />
    	</addColumn>
    </changeSet>  
    	
    <changeSet id="#1886_20160728_offer_service" author="EdwardPLegaspi">
    	<addColumn tableName="cat_offer_template">
    		<column name="long_description" type="TEXT"></column>
    	</addColumn>
    	<addColumn tableName="cat_service_template">
    		<column name="long_description" type="TEXT"></column>
    	</addColumn>
    </changeSet>     
    	
	<changeSet id="#1839_20160713_channel" author="EdwardLegaspi">
		<createTable tableName="cat_channel">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="provider_id" type="BIGINT" />
			<column name="version" type="INT4" />
			<column name="disabled" type="BOOL">
				<constraints nullable="false" />
			</column>
			<column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
				<constraints nullable="false" />
			</column>
			<column name="updated" type="TIMESTAMP WITHOUT TIME ZONE" />
			<column name="code" type="VARCHAR(60)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="VARCHAR(100)" />
			<column name="creator_id" type="BIGINT" />
			<column name="updater_id" type="BIGINT" />
		</createTable>

		<createSequence sequenceName="cat_channel_seq" />
		<addPrimaryKey columnNames="id" constraintName="cat_channel_pkey"
			tableName="cat_channel" />
		<addUniqueConstraint columnNames="code, provider_id"
			constraintName="uk_cat_channel" deferrable="false" disabled="false"
			initiallyDeferred="false" tableName="cat_channel" />
		<addForeignKeyConstraint baseColumnNames="provider_id"
			baseTableName="cat_channel" constraintName="fk_cat_channel_crm_provider"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />
		<addForeignKeyConstraint baseColumnNames="creator_id"
			baseTableName="cat_channel" constraintName="fk_cat_channel_adm_user_c"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
		<addForeignKeyConstraint baseColumnNames="updater_id"
			baseTableName="cat_channel" constraintName="fk_cat_channel_adm_user_u"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
	</changeSet>

	<changeSet id="#1839_20160713_cat_business_product_model"
		author="EdwardLegaspi">
		<createTable tableName="cat_business_product_model">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
		</createTable>

		<addPrimaryKey columnNames="id"
			constraintName="pk_cat_business_product_model" tableName="cat_business_product_model" />
	</changeSet>

	<changeSet id="#1839_20160719_bam" author="EdwardPLegaspi">
		<addPrimaryKey tableName="crm_business_account_model"
			columnNames="id" />
	</changeSet>

	<changeSet id="#1839_20160713_cat_product_offering" author="EdwardLegaspi">
		<addColumn tableName="cat_offer_template">
			<column name="life_cycle_status" type="VARCHAR(60)" />
			<column name="type" type="VARCHAR(20)">
				<constraints nullable="false" />
			</column>
		</addColumn>
		
		<sql>UPDATE cat_offer_template SET TYPE='OFFER'</sql>
		
		<addForeignKeyConstraint baseColumnNames="cat_offer_template_cat_id"
			baseTableName="cat_offer_template" constraintName="fk_cat_offer_template_offer_tpl_cat"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id"
			referencedTableName="cat_offer_template_category" />
		<addForeignKeyConstraint baseColumnNames="business_offer_model_id"
			baseTableName="cat_offer_template" constraintName="fk_prod_offer_template_bom"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_business_offer_model" />			

		<createTable tableName="cat_product_offer_tmpl_cat">
			<column name="product_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="offer_template_cat_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="indx" type="INT4">
				<constraints nullable="false" />
			</column>
		</createTable>

		<addPrimaryKey columnNames="product_id, offer_template_cat_id"
			constraintName="cat_product_offer_tmpl_cat_pkey" tableName="cat_product_offer_tmpl_cat" />
		<addForeignKeyConstraint baseColumnNames="product_id" baseTableName="cat_product_offer_tmpl_cat" constraintName="fk_cat_prod_offer_tmpl_prod_offer" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />
        <addForeignKeyConstraint baseColumnNames="offer_template_cat_id" baseTableName="cat_product_offer_tmpl_cat" constraintName="fk_cat_product_offer_tmpl_cat_r" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template_category" />
            
        <createTable tableName="cat_product_offer_bam">
			<column name="product_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="bam_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="indx" type="INT4">
				<constraints nullable="false" />
			</column>
		</createTable>
		
		<addPrimaryKey columnNames="product_id, bam_id"
			constraintName="cat_product_offer_bam_pkey" tableName="cat_product_offer_bam" />
		<addForeignKeyConstraint baseColumnNames="product_id" baseTableName="cat_product_offer_bam" constraintName="fk_cat_prod_offer_bam_l" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />      
		<addForeignKeyConstraint baseColumnNames="bam_id" baseTableName="cat_product_offer_bam" constraintName="fk_cat_prod_offer_bam_r" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_business_account_model" />
            
        <createTable tableName="cat_product_offer_channels">
			<column name="product_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="channel_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="indx" type="INT4">
				<constraints nullable="false" />
			</column>
		</createTable>
		
		<addPrimaryKey columnNames="product_id, channel_id"
			constraintName="cat_prod_off_channels_pkey" tableName="cat_product_offer_channels" />
		<addForeignKeyConstraint baseColumnNames="product_id" baseTableName="cat_product_offer_channels" constraintName="fk_cat_prod_offer_chan_l" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />      
		<addForeignKeyConstraint baseColumnNames="channel_id" baseTableName="cat_product_offer_channels" constraintName="fk_cat_prod_offer_chan_r" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_channel" />
	</changeSet>

	<changeSet id="#1839_20160713_digital_resource" author="EdwardLegaspi">
		<createTable tableName="cat_digital_resource">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="provider_id" type="BIGINT" />
			<column name="version" type="INT4" />
			<column name="disabled" type="BOOL">
				<constraints nullable="false" />
			</column>
			<column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
				<constraints nullable="false" />
			</column>
			<column name="updated" type="TIMESTAMP WITHOUT TIME ZONE" />
			<column name="code" type="VARCHAR(60)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="VARCHAR(100)" />
			<column name="creator_id" type="BIGINT" />
			<column name="updater_id" type="BIGINT" />
			<column name="uri" type="VARCHAR(255)" />
			<column name="mime_type" type="VARCHAR(50)" />			
		</createTable>

		<createSequence sequenceName="cat_digital_resource_seq" />
		<addPrimaryKey columnNames="id" constraintName="cat_digital_resource_pkey"
			tableName="cat_digital_resource" />
		<addUniqueConstraint columnNames="code, provider_id"
			constraintName="uk_digital_resource" deferrable="false" disabled="false"
			initiallyDeferred="false" tableName="cat_digital_resource" />
		<addForeignKeyConstraint baseColumnNames="provider_id"
			baseTableName="cat_digital_resource" constraintName="fk_cat_dig_res_crm_provider"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />
		<addForeignKeyConstraint baseColumnNames="creator_id"
			baseTableName="cat_digital_resource" constraintName="fk_cat_dig_res_adm_user_c"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
		<addForeignKeyConstraint baseColumnNames="updater_id"
			baseTableName="cat_digital_resource" constraintName="fk_cat_dig_res_adm_user_u"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
			
		<createTable tableName="cat_product_offer_digital_res">
			<column name="product_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="digital_resource_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="indx" type="INT4">
				<constraints nullable="false" />
			</column>
		</createTable>
		
		<addPrimaryKey columnNames="product_id, digital_resource_id"
			constraintName="cat_product_offer_digital_res_pkey" tableName="cat_product_offer_digital_res" />
		<addForeignKeyConstraint baseColumnNames="product_id" baseTableName="cat_product_offer_digital_res" constraintName="fk_cat_product_offer_digital_res_l" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />
        <addForeignKeyConstraint baseColumnNames="digital_resource_id" baseTableName="cat_product_offer_digital_res" constraintName="fk_cat_product_offer_digital_res_r" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_digital_resource" />		
	</changeSet>

	<changeSet id="#1839_20160713_cat_product_charge_templ"
		author="SebastienMichea">
		<createTable tableName="cat_product_charge_templ">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
		</createTable>
		<addPrimaryKey columnNames="id" constraintName="cat_prod_charge_templ_pkey"
			tableName="cat_product_charge_templ" />
	</changeSet>

	<changeSet id="#1839_20160713_cat_product_template" author="EdwardLegaspi">
		<addColumn tableName="cat_offer_template">
			<column name="product_charge_tmpl_id" type="BIGINT"></column>
			<column name="business_product_model_id" type="BIGINT"></column>
            <column name="invoicing_calendar_id" type="BIGINT" />
		</addColumn>

		<addForeignKeyConstraint baseColumnNames="product_charge_tmpl_id"
			baseTableName="cat_offer_template" constraintName="fk_cat_off_tpl_prod_chrg_tpl"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_product_charge_templ" />
		<addForeignKeyConstraint baseColumnNames="business_product_model_id"
			baseTableName="cat_offer_template" constraintName="fk_cat_off_tpl_buss_prod_mod"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id"
			referencedTableName="cat_business_product_model" />
		<addForeignKeyConstraint baseColumnNames="invoicing_calendar_id"
		   baseTableName="cat_offer_template" constraintName="fk_off_tpl_prodcal"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" 
            referencedColumnNames="id" referencedTableName="cat_calendar" />

		<createTable tableName="cat_product_wallet_template">
			<column name="product_template_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="wallet_template_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="indx" type="INT4">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>

	<changeSet id="#1839_20160713_cat_offer_product_template"
		author="EdwardLegaspi">
		<createTable tableName="cat_offer_product_template">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="provider_id" type="BIGINT" />
			<column name="version" type="INT4" />
			<column name="offer_template_id" type="BIGINT" />
			<column name="product_template_id" type="BIGINT" />
			<column name="mandatory" type="BOOL" />
		</createTable>

		<createSequence sequenceName="cat_offer_product_template_seq" />
		<addPrimaryKey columnNames="id"
			constraintName="cat_offer_product_template_pkey" tableName="cat_offer_product_template" />
		<addForeignKeyConstraint baseColumnNames="provider_id"
			baseTableName="cat_offer_product_template" constraintName="fk_cat_off_prod_tpl_crm_provider"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />
		<addForeignKeyConstraint baseColumnNames="offer_template_id"
			baseTableName="cat_offer_product_template" constraintName="fk_cat_off_pro_tpl_offer_template"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />
		<addForeignKeyConstraint baseColumnNames="product_template_id"
			baseTableName="cat_offer_product_template" constraintName="fk_cat_off_prod_tpl_off_tpl"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />
	</changeSet>

	<changeSet id="#1839_20160713_cat_bundle_product_template"
		author="EdwardLegaspi">
		<createTable tableName="cat_bundle_product_template">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="provider_id" type="BIGINT" />
			<column name="version" type="INT4" />
			<column name="product_template_id" type="BIGINT" />
			<column name="bundle_template_id" type="BIGINT" />
			<column name="quantity" type="INT4" />
		</createTable>

		<createSequence sequenceName="cat_bundle_product_template_seq" />
		<addPrimaryKey columnNames="id" constraintName="cat_bundle_prod_tpl_pkey"
			tableName="cat_bundle_product_template" />
		<addForeignKeyConstraint baseColumnNames="provider_id"
			baseTableName="cat_bundle_product_template" constraintName="fk_cat_bun_prod_tpl_crm_prov"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />
		<addForeignKeyConstraint baseColumnNames="product_template_id"
			baseTableName="cat_bundle_product_template" constraintName="fk_cat_bun_pro_tpl_prod_off_tpl"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />
		<addForeignKeyConstraint baseColumnNames="bundle_template_id"
			baseTableName="cat_bundle_product_template" constraintName="fk_cat_bun_prod_tpl_prod_off_tpl"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />
	</changeSet>

	<changeSet id="#1839_20160713_billing_charge_instance"
		author="SebastienMichea">
		<addColumn tableName="billing_charge_instance">
			<column name="user_account_id" type="BIGINT"></column>
			<column name="offer_template_id" type="BIGINT"></column>
		</addColumn>

		<addForeignKeyConstraint baseColumnNames="user_account_id"
			baseTableName="billing_charge_instance" constraintName="fk_chrg_instance_ua"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="billing_user_account" />
		<addForeignKeyConstraint baseColumnNames="offer_template_id"
			baseTableName="billing_charge_instance" constraintName="fk_chrg_instance_offer"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />
	</changeSet>
	
	<changeSet id="#1839_20160713_billing_product_inst"
		author="SebastienMichea">
		<createTable tableName="billing_product_instance">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="version" type="INT4" />
			<column name="disabled" type="BOOL">
				<constraints nullable="false" />
			</column>
			<column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
				<constraints nullable="false" />
			</column>
			<column name="updated" type="TIMESTAMP WITHOUT TIME ZONE" />
			<column name="provider_id" type="BIGINT" />
			<column name="creator_id" type="BIGINT" />
			<column name="updater_id" type="BIGINT" />
            <column name="UUID" type="VARCHAR(60)"/>
			<column name="code" type="VARCHAR(60)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="VARCHAR(100)" />
			<column name="product_template_id" type="BIGINT" />
			<column name="quantity" type="numeric(23, 12)" />
			<column name="user_account_id" type="BIGINT"></column>
			<column name="application_date" type="TIMESTAMP WITHOUT TIME ZONE" />
		</createTable>
		<createSequence sequenceName="billing_product_instance_seq" />
		<addPrimaryKey columnNames="id" constraintName="billing_product_instance_pkey"
			tableName="billing_product_instance" />
			
		<addUniqueConstraint columnNames="code, provider_id"
			constraintName="uk_product_instance" deferrable="false" disabled="false"
			initiallyDeferred="false" tableName="billing_product_instance" />
		
		<addForeignKeyConstraint baseColumnNames="provider_id"
			baseTableName="billing_product_instance" constraintName="fk_prod_inst_crm_provider"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />
		<addForeignKeyConstraint baseColumnNames="creator_id"
			baseTableName="billing_product_instance" constraintName="fk_prod_inst_adm_user_c"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
		<addForeignKeyConstraint baseColumnNames="updater_id"
			baseTableName="billing_product_instance" constraintName="fk_prod_inst_adm_user_u"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
		<addForeignKeyConstraint baseColumnNames="product_template_id"
			baseTableName="billing_product_instance" constraintName="fk_productci_off_tpl"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />
		<addForeignKeyConstraint baseColumnNames="user_account_id"
			baseTableName="billing_product_instance" constraintName="fk_prod_instance_ua"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="billing_user_account" />
	</changeSet>

	<changeSet id="#1839_20160713_billing_product_charge_inst"
		author="SebastienMichea">
		<createTable tableName="billing_product_charge_inst">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="product_instance_id" type="BIGINT" />
			<column name="product_chrg_tmpl_id" type="BIGINT" />
			<column name="quantity" type="numeric(23, 12)" />
		</createTable>
		<createSequence sequenceName="billing_product_charge_inst_seq" />
		<addPrimaryKey columnNames="id" constraintName="billing_prod_chg_inst_pkey"
			tableName="billing_product_charge_inst" />
		<addForeignKeyConstraint baseColumnNames="product_instance_id"
			baseTableName="billing_product_charge_inst" constraintName="fk_productci_prodins"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="billing_product_instance" />
		<addForeignKeyConstraint baseColumnNames="product_chrg_tmpl_id"
			baseTableName="billing_product_charge_inst" constraintName="fk_productci_prodchrgtempl"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_product_charge_templ" />
	</changeSet>

    <changeSet id="#1839_20160719_orders" author="AndriusKarpavicius">

        <createSequence sequenceName="ord_order_seq" />

        <createTable tableName="ord_order">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="disabled" type="BOOL">
                <constraints nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="TIMESTAMP WITHOUT TIME ZONE" />
            <column name="provider_id" type="BIGINT" />
            <column name="creator_id" type="BIGINT" />
            <column name="updater_id" type="BIGINT" />
            <column name="code" type="VARCHAR(60)">
                <constraints nullable="false" />
            </column>
            <column name="description" type="VARCHAR(100)" />
            <column name="external_id" type="VARCHAR(100)" />
            <column name="delivery_instructions" type="TEXT" />
            <column name="order_date" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false" />
            </column>
            <column name="REQ_START_DATE" type="TIMESTAMP WITHOUT TIME ZONE" />
            <column name="REQ_COMPLETION_DATE" type="TIMESTAMP WITHOUT TIME ZONE" />
            <column name="EXP_COMPLETION_DATE" type="TIMESTAMP WITHOUT TIME ZONE" />
            <column name="COMPLETION_DATE" type="TIMESTAMP WITHOUT TIME ZONE" />
            <column name="priority" type="int" defaultValueNumeric="2" />
            <column name="category" type="VARCHAR(200)" />
            <column name="status" type="VARCHAR(20)">
                <constraints nullable="false" />
            </column>
        </createTable>

        <addPrimaryKey columnNames="id" constraintName="ord_order_pkey" tableName="ord_order" />

        <addForeignKeyConstraint baseColumnNames="provider_id" baseTableName="ord_order" constraintName="fk_ord_order_crm_provider" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />

        <addForeignKeyConstraint baseColumnNames="creator_id" baseTableName="ord_order" constraintName="fk_creator_ord_order_adm_user" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />

        <addForeignKeyConstraint baseColumnNames="updater_id" baseTableName="ord_order" constraintName="fk_updater_ord_order_adm_user" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />

        <addUniqueConstraint columnNames="code,provider_id" constraintName="uk_ord_order" deferrable="false" disabled="false"
            initiallyDeferred="false" tableName="ord_order" />
            
        <createSequence sequenceName="ord_order_item_seq" />

        <createTable tableName="ord_order_item">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="provider_id" type="BIGINT" />
            <column name="order_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="item_id" type="VARCHAR(10)">
                <constraints nullable="false" />
            </column>
            <column name="action" type="VARCHAR(10)">
                <constraints nullable="false" />
            </column>
            <column name="user_account_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="source" type="TEXT">
                <constraints nullable="false" />
            </column>
            <column name="status" type="VARCHAR(20)">
                <constraints nullable="false" />
            </column>
            <column name="subscription_id" type="BIGINT" />
        </createTable>

        <addPrimaryKey columnNames="id" constraintName="ord_order_item_pkey" tableName="ord_order_item" />

        <addForeignKeyConstraint baseColumnNames="provider_id" baseTableName="ord_order_item" constraintName="fk_ord_order_item_crm_provider" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />

        <addForeignKeyConstraint baseColumnNames="order_id" baseTableName="ord_order_item" constraintName="fk_ord_order_item_ord_order" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ord_order" />

        <addForeignKeyConstraint baseColumnNames="user_account_id" baseTableName="ord_order_item" constraintName="fk_ord_order_item_user_account"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="BILLING_USER_ACCOUNT" />

        <addForeignKeyConstraint baseColumnNames="subscription_id" baseTableName="ord_order_item" constraintName="fk_ord_order_item_subscription"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="BILLING_SUBSCRIPTION" />


        <createTable tableName="ORD_ITEM_OFFERINGS">
            <column name="ORDER_ITEM_ID" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="PRD_OFFERING_ID" type="BIGINT">
                <constraints nullable="false" />
            </column>
        </createTable>

        <addForeignKeyConstraint baseColumnNames="ORDER_ITEM_ID" baseTableName="ORD_ITEM_OFFERINGS" constraintName="fk_ord_item_offerings_order" deferrable="false"
            initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ord_order_item" />

        <addForeignKeyConstraint baseColumnNames="PRD_OFFERING_ID" baseTableName="ORD_ITEM_OFFERINGS" constraintName="fk_ord_item_offerings_prd_offering"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="CAT_OFFER_TEMPLATE" />


        <createTable tableName="ORD_ITEM_PRD_INSTANCE">
            <column name="ORDER_ITEM_ID" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="PRD_INSTANCE_ID" type="BIGINT">
                <constraints nullable="false" />
            </column>
        </createTable>

        <addForeignKeyConstraint baseColumnNames="ORDER_ITEM_ID" baseTableName="ORD_ITEM_PRD_INSTANCE" constraintName="fk_ord_item_prd_instance_order"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ord_order_item" />

        <addForeignKeyConstraint baseColumnNames="PRD_INSTANCE_ID" baseTableName="ORD_ITEM_PRD_INSTANCE" constraintName="fk_ord_item_prd_instance_prd_instance"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="BILLING_PRODUCT_INSTANCE" />


    </changeSet>

    <changeSet id="#1844_20160722" author="AndriusKarpavicius">
        <addColumn tableName="ord_order">
            <column name="STATUS_MESSAGE" type="VARCHAR(2000)"/>
            <column name="ROUTED_TO_USER_ID" type="BIGINT"/>
            <column name="RECEIVED_FROM" type="VARCHAR(50)"/>
            <column name="start_date" type="TIMESTAMP WITHOUT TIME ZONE"/>
        </addColumn>
        
        <addForeignKeyConstraint baseColumnNames="ROUTED_TO_USER_ID" baseTableName="ORD_ORDER" constraintName="fk_ord_order_rt_user"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
        
    </changeSet>
    
	<changeSet id="#1839_20160810_offer_template_category" author="EdwardLegaspi">
		<sql>INSERT INTO CAT_PRODUCT_OFFER_TMPL_CAT (product_id, offer_template_cat_id, indx) SELECT id, cat_offer_template_cat_id, 0 FROM cat_offer_template WHERE cat_offer_template_cat_id IS NOT NULL;</sql>
		<dropColumn tableName="cat_offer_template" columnName="cat_offer_template_cat_id"/>
	</changeSet>
	     
    <changeSet author="pbach (generated)" id="#1863_04082016-165">
        <createTable tableName="hierarchy_entity">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT4"/>
            <column name="disabled" type="BOOL">
                <constraints nullable="false"/>
            </column>
            <column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="updated" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="code" type="VARCHAR(60)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="VARCHAR(100)"/>
            <column name="hierarchy_type" type="VARCHAR(10)"/>
            <column name="parent_id" type="BIGINT"/>
            <column name="order_level" type="BIGINT"/>
            <column name="provider_id" type="BIGINT"/>
            <column name="creator_id" type="BIGINT"/>
            <column name="updater_id" type="BIGINT"/>
        </createTable>
        
        <createSequence sequenceName="hierarchy_entity_seq" />
        <addPrimaryKey columnNames="id" constraintName="hierarchy_entity_pkey"
                       tableName="hierarchy_entity" />
        <addForeignKeyConstraint baseColumnNames="provider_id"
                                 baseTableName="hierarchy_entity" constraintName="fk_hierarchy_entity_crm_provider"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />

        <addForeignKeyConstraint baseColumnNames="creator_id"
                                 baseTableName="hierarchy_entity" constraintName="fk_creator_hierarchy_entity_adm_user"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />

        <addForeignKeyConstraint baseColumnNames="updater_id"
                                 baseTableName="hierarchy_entity" constraintName="fk_updater_hierarchy_entity_adm_user"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
        <addForeignKeyConstraint baseColumnNames="parent_id"
                                 baseTableName="hierarchy_entity" constraintName="fk_hierarchy_entity_hierarchy_entity"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="hierarchy_entity" />
        <addUniqueConstraint columnNames="code, hierarchy_type, provider_id" constraintName="uk_code_hierarchy_provider" deferrable="false" disabled="false"
                             initiallyDeferred="false" tableName="hierarchy_entity" />

        <addColumn tableName="adm_user">
            <column name="hierarchy_level_id" type="BIGINT" />
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="hierarchy_level_id"
                                 baseTableName="adm_user" constraintName="fk_hierarchy_level_adm_user_hierarchy_entity"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="hierarchy_entity" />
    </changeSet>
    <changeSet id="#1842_20160720" author="TyshanShi">
		<sql>update crm_provider_contact a set address_country =(select description_en from adm_country c where 
			lower(c.country_code)=lower(a.address_country) or lower(c.description_en)=lower(a.address_country))
			where a.address_country in (select c.country_code from adm_country c);
		</sql>
		<sql>update account_entity a set address_country =(select description_en from adm_country c where 
			lower(c.country_code)=lower(a.address_country) or lower(c.description_en)=lower(a.address_country)) 
			where a.address_country in (select c.country_code from adm_country c);
		</sql>
    </changeSet>
    <changeSet id="#1637_20160819_1" author="TyshanShi">
    	<addColumn tableName="ADM_MESSAGES">
    		<column name="ENTITY_CLASS" type="varchar(60)"/>
    		<column name="ENTITY_CODE" type="varchar(60)"/>
    	</addColumn>
    	<dropForeignKeyConstraint baseTableName="ADM_MESSAGES" constraintName="fk_1t16h6ap26fd0qv8rajmtnh7s"/>
    	<dropForeignKeyConstraint baseTableName="ADM_MESSAGES" constraintName="fk_6uvqkaxibmlp4c12y6pb330jm"/>
    	<dropColumn tableName="ADM_MESSAGES" columnName="disabled"/>
    	<dropColumn tableName="ADM_MESSAGES" columnName="created"/>
    	<dropColumn tableName="ADM_MESSAGES" columnName="updated"/>
    	<dropColumn tableName="ADM_MESSAGES" columnName="creator_id"/>
    	<dropColumn tableName="ADM_MESSAGES" columnName="updater_id"/>
    	<addUniqueConstraint columnNames="entity_code,entity_class,language_code,provider_id" tableName="ADM_MESSAGES" constraintName="uk_6clw4f7dfrs63yijhrwc87vnq"
    		deferrable="false" disabled="false" initiallyDeferred="false"/>
    	<createIndex tableName="ADM_MESSAGES" indexName="idx_code_class_lngcode_provider" unique="true">
    		<column name="entity_code"/>
    		<column name="entity_class"/>
    		<column name="language_code"/>
    		<column name="provider_id"></column>
    	</createIndex>
    </changeSet>  
    	
    <changeSet id="#1637_20160819_2" author="TyshanShi">
		<sql>update ADM_MESSAGES a set ENTITY_CODE =(select (code) from CAT_CHARGE_TEMPLATE where 
				id =(select cast(substring(code, position('_' in code)+1) as bigint) from 
				ADM_MESSAGES b  where  a.id=b.id)) where a.code like 'RecurringChargeTemplate_%' or a.code like
				'OneShotChargeTemplate_%' or a.code like 'UsageChargeTemplate_%'</sql>
		<sql>update ADM_MESSAGES a set ENTITY_CODE =(select (code) from BILLING_INVOICE_CAT where id = 
				(select cast(substring(code, position('_' in code)+1) as bigint) from 
				ADM_MESSAGES b  where a.id=b.id)) where a.code like 'InvoiceCategory_%'</sql>
		<sql>update ADM_MESSAGES a set ENTITY_CODE =(select (code) from BILLING_INVOICE_SUB_CAT where id = 
				(select cast(substring(code, position('_' in code)+1) as bigint) from 
				ADM_MESSAGES b  where a.id=b.id)) where a.code like 'InvoiceSubCategory_%'</sql>
		<sql>update ADM_MESSAGES a set ENTITY_CODE =(select (code) from BILLING_TAX where id = 
				(select cast(substring(code, position('_' in code)+1) as bigint) from 
				ADM_MESSAGES b  where a.id=b.id)) where a.code like 'Tax_%'</sql>
		<sql>update ADM_MESSAGES a set ENTITY_CODE =(select (code) from CAT_PRICE_PLAN_MATRIX where id = 
				(select cast(substring(code, position('_' in code)+1) as bigint) from 
				ADM_MESSAGES b  where a.id=b.id)) where a.code like 'PricePlanMatrix_%'</sql>
		<sql>update ADM_MESSAGES a set ENTITY_CODE =(select (code) from ADM_TITLE where id = 
				(select cast(substring(code, position('_' in code)+1) as bigint) from 
				ADM_MESSAGES b  where a.id=b.id)) where  a.code like 'Title_%'</sql>
		<sql>update ADM_MESSAGES a set ENTITY_CLASS =(select substring(code,0, position('_' in code)) from 
				ADM_MESSAGES b where a.id=b.id) where a.code like '%_%'</sql>
		<sql>alter table ADM_MESSAGES drop column code</sql>
	</changeSet>
    	
    <changeSet author="pbach (generated)" id="#1861_16082016-165">
        <createTable tableName="wf_transition_rule">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT4"/>
            <column name="disabled" type="BOOL">
                <constraints nullable="false"/>
            </column>
            <column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="updated" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="condition_el" type="VARCHAR(2000)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="value" type="VARCHAR(255)"/>
            <column name="provider_id" type="BIGINT"/>
            <column name="creator_id" type="BIGINT"/>
            <column name="updater_id" type="BIGINT"/>
            <column name="priority" type="INT4"/>
            <column name="type" type="VARCHAR(255)"/>
            <column name="model" type="BOOL"/>
        </createTable>
    
        <addPrimaryKey columnNames="id" constraintName="wf_wf_transition_rule_pkey"
                       tableName="wf_transition_rule" />

        <addForeignKeyConstraint baseColumnNames="provider_id"
                                 baseTableName="wf_transition_rule" constraintName="fk_provider_wf_transition_rule_crm_provider"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />

        <addForeignKeyConstraint baseColumnNames="creator_id"
                                 baseTableName="wf_transition_rule" constraintName="fk_creator_wf_transition_rule_adm_user"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />

        <addForeignKeyConstraint baseColumnNames="updater_id"
                                 baseTableName="wf_transition_rule" constraintName="fk_updater_wf_transition_rule_adm_user"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />

        <addUniqueConstraint columnNames="name, value, provider_id" constraintName="uk_name_value_provider_id" deferrable="false" disabled="false"
                             initiallyDeferred="false" tableName="wf_transition_rule" />

        <createTable tableName="wf_transition_transition_rule">
            <column name="transition_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="transition_rule_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
        </createTable>

        <addForeignKeyConstraint baseColumnNames="transition_id"
                                 baseTableName="wf_transition_transition_rule" constraintName="fk_transition_id_wf_transition"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="wf_transition" />

        <addForeignKeyConstraint baseColumnNames="transition_rule_id"
                                 baseTableName="wf_transition_transition_rule" constraintName="fk_transition_rule_id_transition_rule"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="wf_transition_rule" />

        <createSequence sequenceName="wf_transition_rule_seq" />
    </changeSet>


    <changeSet author="pbach (generated)" id="#1861_26082016-166">
        <addColumn tableName="wf_transition">
            <column name="priority" type="INT4" />
        </addColumn>
        <addColumn tableName="wf_transition">
            <column name="description" type="VARCHAR(100)"/>
        </addColumn>
        <dropUniqueConstraint tableName="wf_transition" constraintName="uk_7xdivt2yngk5mmjfdy2x73cad" />

        <addUniqueConstraint columnNames="from_status, to_status, priority, workflow_id, provider_id" constraintName="uk_from_status_to_status_priority_workflow_provider" deferrable="false" disabled="false" initiallyDeferred="false" tableName="wf_transition"/>
    </changeSet>

	<changeSet id="#cat_bundle_template_add_uk" author="EdwardLegaspi">
		<addUniqueConstraint
			columnNames="product_template_id, bundle_template_id"
			constraintName="uk_cat_bundle_prod_tpl" deferrable="false"
			disabled="false" initiallyDeferred="false" tableName="cat_bundle_product_template" />
	</changeSet>

	<changeSet id="#cat_offer_product_template_cat_bundle_product_template" author="EdwardLegaspi">
		<dropColumn tableName="cat_offer_product_template" columnName="version"/>
		<dropColumn tableName="cat_offer_product_template" columnName="provider_id"/>
		<dropColumn tableName="cat_bundle_product_template" columnName="version"/>
		<dropColumn tableName="cat_bundle_product_template" columnName="provider_id"/>
	</changeSet>
	

    <changeSet author="pbach (generated)" id="#1861_05092016-167">
        <createTable tableName="wf_decision_rule">
            <column name="id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="INT4"/>
            <column name="disabled" type="BOOL">
                <constraints nullable="false"/>
            </column>
            <column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="updated" type="TIMESTAMP WITHOUT TIME ZONE"/>
            <column name="condition_el" type="VARCHAR(2000)"/>
            <column name="name" type="VARCHAR(255)"/>
            <column name="value" type="VARCHAR(255)"/>
            <column name="provider_id" type="BIGINT"/>
            <column name="creator_id" type="BIGINT"/>
            <column name="updater_id" type="BIGINT"/>
            <column name="type" type="VARCHAR(255)"/>
            <column name="model" type="BOOL"/>
        </createTable>

        <addPrimaryKey columnNames="id" constraintName="wf_wf_decision_rule_pkey"
                       tableName="wf_decision_rule" />

        <addForeignKeyConstraint baseColumnNames="provider_id"
                                 baseTableName="wf_decision_rule" constraintName="fk_provider_wf_decision_rule_crm_provider"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />

        <addForeignKeyConstraint baseColumnNames="creator_id"
                                 baseTableName="wf_decision_rule" constraintName="fk_creator_wf_decision_rule_adm_user"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />

        <addForeignKeyConstraint baseColumnNames="updater_id"
                                 baseTableName="wf_decision_rule" constraintName="fk_updater_wf_decision_rule_adm_user"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />

        <addUniqueConstraint columnNames="name, value, provider_id" constraintName="uk_decision_rule_name_value_provider_id" deferrable="false" disabled="false"
                             initiallyDeferred="false" tableName="wf_decision_rule" />

        <createTable tableName="wf_transition_decision_rule">
            <column name="transition_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="decision_rule_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
        </createTable>

        <addForeignKeyConstraint baseColumnNames="transition_id"
                                 baseTableName="wf_transition_decision_rule" constraintName="fk_transition_id_wf_transition"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="wf_transition" />

        <addForeignKeyConstraint baseColumnNames="decision_rule_id"
                                 baseTableName="wf_transition_decision_rule" constraintName="fk_decision_rule_id_decision_rule"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="wf_decision_rule" />

        <createSequence sequenceName="wf_decision_rule_seq" />

        <dropUniqueConstraint tableName="wf_transition" constraintName="uk_from_status_to_status_priority_workflow_provider" />
        <dropUniqueConstraint tableName="wf_action" constraintName="uk_cr97e5dxkl6ps0coltjw6i28y" />
        <addColumn tableName="wf_transition">
            <column name="UUID" type="VARCHAR(60)"/>
        </addColumn>
        <addColumn tableName="wf_action">
            <column name="UUID" type="VARCHAR(60)"/>
        </addColumn>
        <addUniqueConstraint columnNames="uuid, provider_id" constraintName="uk_wf_transition_uuid_provider_id" deferrable="false" disabled="false"
                             initiallyDeferred="false" tableName="wf_transition" />
        <addUniqueConstraint columnNames="uuid, provider_id" constraintName="uk_wf_action_uuid_provider_id" deferrable="false" disabled="false"
                             initiallyDeferred="false" tableName="wf_action" />
        <sql>
            INSERT INTO wf_decision_rule SELECT id, version, disabled, created, updated, condition_el, name,
            value, provider_id, creator_id, updater_id, type, model
            FROM wf_transition_rule;
            INSERT INTO wf_transition_decision_rule select * from wf_transition_transition_rule;
            SELECT SETVAL('wf_decision_rule_seq', (SELECT MAX(id) FROM wf_decision_rule) + 1);
            update wf_transition set UUID='TRANSITION-'||id where UUID is null;
            update wf_action set UUID='ACTION-'||id where UUID is null;
        </sql>

        <addNotNullConstraint tableName="WF_TRANSITION" columnName="UUID"/>
        <addNotNullConstraint tableName="WF_ACTION" columnName="UUID"/>

        <dropTable tableName="wf_transition_transition_rule"/>
        <dropTable tableName="wf_transition_rule"/>
        <dropSequence sequenceName="wf_transition_rule_seq"/>
        <dropColumn tableName="WF_WORKFLOW" columnName="status"/>
    </changeSet>
    
    <changeSet author="anasseh" id="#2007_10092016">
  	   <dropColumn tableName="WF_WORKFLOW" columnName="EXPORT_LOT"/>
    </changeSet>

    <changeSet author="Andrius Karpavicius" id="#1819-2016-08-05">       
        <addColumn tableName="CRM_CUSTOM_FIELD_TMPL" >
            <column name="INDEX_TYPE" type="varchar(10)"/>
        </addColumn>
    </changeSet> 

    <changeSet id="#1844_20160903" author="pbach">
        <dropColumn tableName="ord_order" columnName="ROUTED_TO_USER_ID"></dropColumn>
        <addColumn tableName="ord_order">
            <column name="ROUTED_TO_USER_GROUP_ID" type="BIGINT"/>
        </addColumn>
    </changeSet>
    
    <changeSet id="#1889_20160908" author="AndriusKarpavicius">
        <addColumn tableName="ORD_ORDER">
            <column name="UUID" type="VARCHAR(60)"/>
        </addColumn>
        <sql>update ORD_ORDER set UUID ='ORDER-'|| id </sql>   
        <addNotNullConstraint tableName="ORD_ORDER" columnName="UUID"/> 
        
        <addNotNullConstraint tableName="BILLING_TAX" columnName="UUID"/> 
        <addNotNullConstraint tableName="BILLING_CYCLE" columnName="UUID"/> 
        <addNotNullConstraint tableName="billing_product_instance" columnName="UUID"/> 
    </changeSet>

    <changeSet id="#1844_20160910" author="pbach">
        <sql>update WF_ACTION set ACTION_EL = REPLACE(ACTION_EL, ',', ',"') where WF_TRANSITION_ID in
            (select ID from WF_TRANSITION where WORKFLOW_ID in (select id from wf_workflow where wf_type='org.meveo.admin.wf.types.OrderWF'));
        </sql>
        <sql>update WF_ACTION set ACTION_EL = REPLACE(ACTION_EL, ')}', '")}') where WF_TRANSITION_ID in
            (select ID from WF_TRANSITION where WORKFLOW_ID in (select id from wf_workflow where wf_type='org.meveo.admin.wf.types.OrderWF'));
        </sql>
        <sql>update WF_ACTION set ACTION_EL = REPLACE(ACTION_EL, 'routedToUserGroup', 'routeToUserGroup') where WF_TRANSITION_ID in
            (select ID from WF_TRANSITION where WORKFLOW_ID in (select id from wf_workflow where wf_type='org.meveo.admin.wf.types.OrderWF'));
        </sql>
    </changeSet>

    <changeSet id="#1839_20160914" author="pbach">
        <sql>
            update WF_TRANSITION set FROM_STATUS = 'ACKNOWLEDGED', TO_STATUS = 'IN_PROGRESS' where FROM_STATUS is NULL and TO_STATUS is NULL and WORKFLOW_ID in (select id from wf_workflow where wf_type='org.meveo.admin.wf.types.OrderWF');
        </sql>
    </changeSet>
    
    <changeSet id="#2043_20160922" author="smichea">
        <addColumn tableName="BILLING_INV_SUB_CAT_COUNTRY">
            <column name="SELLING_COUNTRY_ID" type="BIGINT"/>
        </addColumn>
        <addColumn tableName="BILLING_INV_SUB_CAT_COUNTRY">
            <column name="TAX_CODE_EL" type="VARCHAR(2000)"/>
        </addColumn>
    </changeSet>

	<changeSet id="#1839_20160717_cat_product_charge_templ" author="TonyAlejandro">
		<addColumn tableName="cat_product_charge_templ">
			<column name="product_tmpl_id" type="BIGINT" />
		</addColumn>
		<addUniqueConstraint columnNames="id, product_tmpl_id"
			constraintName="uk_product_charge_templ" deferrable="false" disabled="false"
			initiallyDeferred="false" tableName="cat_product_charge_templ" />
		<addForeignKeyConstraint baseColumnNames="product_tmpl_id"
			baseTableName="cat_product_charge_templ" constraintName="fk_cat_prod_tpl_prod_chrg_tpl"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cat_offer_template" />
	</changeSet>
	
	<changeSet id="#2058_20160928_remove_product_instance_uk" author="EdwardPLegaspi">
		<dropUniqueConstraint tableName="billing_product_instance"
			constraintName="uk_product_instance" />
	</changeSet>

	<changeSet id="#2060_20160928_remove_offer_template"
		author="SebastienMichea">
		<dropColumn tableName="billing_charge_instance" columnName="offer_template_id"/>
		<addColumn tableName="billing_product_instance">
			<column name="subscription_id" type="BIGINT" />
		</addColumn>		
	</changeSet>
	
	<changeSet author="TonyAlejandro" id="#2070_20160930_account_entity_add_bam_id">
		<addColumn tableName="account_entity">
			<column name="bam_id" type="BIGINT"/>
		</addColumn>
		<addForeignKeyConstraint
				constraintName="fk_account_entity_crm_business_account_model"
				baseTableName="account_entity"
				baseColumnNames="bam_id"
				referencedTableName="crm_business_account_model"
				referencedColumnNames="id"
				deferrable="false" initiallyDeferred="false" onUpdate="NO ACTION" onDelete="NO ACTION"/>
	</changeSet>

	<changeSet author="TonyAlejandro" id="#2070_20160930_seller_add_bam_id">
		<addColumn tableName="crm_seller">
			<column name="bam_id" type="BIGINT"/>
		</addColumn>
		<addForeignKeyConstraint
				constraintName="fk_crm_seller_crm_business_account_model"
				baseTableName="crm_seller"
				baseColumnNames="bam_id"
				referencedTableName="crm_business_account_model"
				referencedColumnNames="id"
				deferrable="false" initiallyDeferred="false" onUpdate="NO ACTION" onDelete="NO ACTION"/>
	</changeSet>

	<changeSet author="anasseh" id="#2036_20161004">
	
	     <createSequence sequenceName="WF_HISTORY_SEQ"/>
	      <createSequence sequenceName="WF_HISTORY_ACTION_SEQ"/>
	     
	     
	     
        <createTable tableName="WF_HISTORY">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="disabled" type="BOOL">
                <constraints nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="TIMESTAMP WITHOUT TIME ZONE" />
            <column name="provider_id" type="BIGINT"/>
            <column name="creator_id" type="BIGINT"/>
            <column name="updater_id" type="BIGINT"/>
            <column name="ENTITY_INSTANCE_CODE" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="FROM_STATUS" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="TO_STATUS" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="TRANSITION_NAME" type="varchar(255)"/>
            <column name="ACTION_DATE" type="TIMESTAMP WITHOUT TIME ZONE" />
            <column name="WORKFLOW_ID" type="BIGINT" />                              
        </createTable>
        
       <createTable tableName="WF_HISTORY_ACTION">    
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />  
             <column name="provider_id" type="BIGINT"/>    
            <column name="ACTION" type="varchar(2000)"/>
            <column name="RESULT" type="varchar(255)" />
            <column name="WF_HISTORY_ID" type="BIGINT" />                              
        </createTable>
    
       
        <addPrimaryKey columnNames="id" constraintName="WF_HISTORY_pkey"  tableName="WF_HISTORY" />
         <addPrimaryKey columnNames="id" constraintName="WF_HISTORY_ACTION_pkey"  tableName="WF_HISTORY_ACTION" />

        <addForeignKeyConstraint baseColumnNames="provider_id"
                                 baseTableName="WF_HISTORY" constraintName="fk_provider_WF_HISTORY_crm_provider"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />
                                 
        <addForeignKeyConstraint baseColumnNames="provider_id"
                                 baseTableName="WF_HISTORY_ACTION" constraintName="fk_provider_WF_HISTORY_ACTION_crm_provider"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />                                 

        <addForeignKeyConstraint baseColumnNames="creator_id"
                                 baseTableName="WF_HISTORY" constraintName="fk_creator_WF_HISTORY_adm_user"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />

        <addForeignKeyConstraint baseColumnNames="updater_id"
                                 baseTableName="WF_HISTORY" constraintName="fk_updater_WF_HISTORY_adm_user"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
                                 
        <addForeignKeyConstraint baseColumnNames="WORKFLOW_ID"
                                 baseTableName="WF_HISTORY" constraintName="fk_workflow_WF_HISTORY_wf_workflow"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="WF_WORKFLOW" />        
                                 
        <addForeignKeyConstraint baseColumnNames="WF_HISTORY_ID"
                                 baseTableName="WF_HISTORY_ACTION" constraintName="fk_workflow_history_WF_HISTORY_ACTION_wf_history"
                                 deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
                                 onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="WF_HISTORY" />
                                 
                                                                                              
        
     </changeSet>
    <changeSet id="#2042_20160921" author="AndriusKarpavicius">
        <sql>update MEVEO_MODULE_ITEM set ITEM_TYPE = 'org.meveo.model.dwh.MeasurableQuantity' where ITEM_TYPE='org.meveocrm.model.dwh.MeasurableQuantity'</sql>
        <sql>update MEVEO_MODULE_ITEM set ITEM_TYPE = 'org.meveo.model.dwh.BarChart' where ITEM_TYPE='org.meveocrm.model.dwh.BarChart'</sql>
        <sql>update MEVEO_MODULE_ITEM set ITEM_TYPE = 'org.meveo.model.dwh.Chart' where ITEM_TYPE='org.meveocrm.model.dwh.Chart'</sql>
        <sql>update MEVEO_MODULE_ITEM set ITEM_TYPE = 'org.meveo.model.dwh.LineChart' where ITEM_TYPE='org.meveocrm.model.dwh.LineChart'</sql>
        <sql>update MEVEO_MODULE_ITEM set ITEM_TYPE = 'org.meveo.model.dwh.PieChart' where ITEM_TYPE='org.meveocrm.model.dwh.PieChart'</sql>
    </changeSet>    

</databaseChangeLog>
