<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd">
	<changeSet id="ticket670_20150322" author="sebastienMichea">
		<addColumn tableName="CAT_SERVICE_TEMPLATE">
			<column name="INVOICING_CALENDAR_ID" type="BIGINT"/>
		</addColumn>
		<addColumn tableName="BILLING_SERVICE_INSTANCE">
			<column name="INVOICING_CALENDAR_ID" type="BIGINT"/>
		</addColumn>
		<addColumn tableName="BILLING_CHARGE_INSTANCE">
			<column name="INVOICING_CALENDAR_ID" type="BIGINT"/>
		</addColumn>
		<addColumn tableName="BILLING_WALLET_OPERATION">
			<column name="INVOICING_DATE" type="TIMESTAMP WITHOUT TIME ZONE"/>
		</addColumn>
	</changeSet>
	<changeSet id="ticket678_20150326" author="AndriusKarpavicius">
		<dropColumn tableName="CRM_PROVIDER" columnName="PROVIDER_ID"/>
		<addUniqueConstraint constraintName="UK_CRM_PROVIDER" columnNames="CODE" tableName="CRM_PROVIDER" />
	</changeSet>
    <changeSet id="ticket528_20150327" author="AndriusKarpavicius">
        <addColumn tableName="BILLING_INVOICE_AGREGATE">
            <column name="DISCOUNT_PERCENT" type="numeric(23, 12)" />
        </addColumn>
    </changeSet>
	<changeSet id="ticket680_20150328" author='SebastienMichea'>
		<addColumn tableName="BILLING_CYCLE">
			<column name="TRANSACTION_DATE_DELAY" type="INT4"/>
		</addColumn>
		<addColumn tableName="BILLING_CYCLE">
			<column name="INVOICE_DATE_PRODUCTION_DELAY" type="INT4"/>
		</addColumn>
		<addColumn tableName="BILLING_BILLING_RUN">
			<column name="INVOICE_DATE" type="TIMESTAMP WITHOUT TIME ZONE"/>
		</addColumn>
		<addColumn tableName="BILLING_BILLING_RUN">
			<column name="LAST_TRANSACTION_DATE" type="TIMESTAMP WITHOUT TIME ZONE"/>
		</addColumn>
	</changeSet>
	<changeSet id="ticket674_20150330" author="SebastienMichea">
		<modifyDataType tableName="JOB_EXECUTION" columnName="REPORT" newDataType="TEXT"/>
	</changeSet>
	<changeSet id="ticket585_20150330" author="SebastienMichea">
		<addColumn tableName="CRM_CUSTOM_FIELD_INST">
			<column name="MEVEO_TIMER_ID" type="BIGINT"/>
		</addColumn>
		<addForeignKeyConstraint baseColumnNames="MEVEO_TIMER_ID"
			baseTableName="CRM_CUSTOM_FIELD_INST" constraintName="fk_customfieldinstmeveotimer"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id"
			referencedTableName="MEVEO_TIMER" />
		<dropUniqueConstraint tableName="crm_custom_field_inst" constraintName="uk_6yeqeouehb38bt3l7r0dy8a0k"/>
	    <addUniqueConstraint columnNames="code, subscription_id, account_id, charge_template_id,service_template_id,offer_template_id,access_id,provider_id"
			constraintName="uk_customfieldinst" deferrable="false"
			disabled="false" initiallyDeferred="false" tableName="crm_custom_field_inst" />
	</changeSet>
	<changeSet id="ticket552_20150331" author="Mbarek">
		<addColumn tableName="AR_DUNNING_PLAN_TRANSITION">
			<column name="CONDITION_EL" type="VARCHAR(1000)"/>
		</addColumn>
		<addColumn tableName="AR_ACTION_PLAN_ITEM">
			<column name="CONDITION_EL" type="VARCHAR(1000)"/>
		</addColumn>
	</changeSet>
	<changeSet id="ticket682_20150410" author="Mbarek">
		<dropTable cascadeConstraints="true" tableName="BILLING_INVOICE_CAT_COUNTRY"/>
		<dropColumn tableName="BILLING_INV_SUB_CAT_COUNTRY" columnName="DISCOUNT_CODE"/>
	</changeSet>
	<changeSet id="ticket542_20150413" author="AndriusKarpavicius">
		<dropTable cascadeConstraints="true" tableName="PROVIDER_TITLES"/>
	</changeSet>	
	<changeSet id="ticket704_20150413" author="AndriusKarpavicius" failOnError="false">
		<dropUniqueConstraint tableName="ACCOUNT_ENTITY" constraintName="uk_mx9oogbtker4j4jyxidjxkmhi"/>
	</changeSet>		
	<changeSet id="ticket542_20150414" author="AndriusKarpavicius">
		<addUniqueConstraint columnNames="CODE, USER_ACCOUNT_ID, PROVIDER_ID" tableName="BILLING_WALLET" constraintName="UK_BILLING_WALLET"/>
	</changeSet>
	<changeSet id="ticket650_20150414" author="Mbarek">
		<dropColumn tableName="DWH_CHART" columnName="USER_ID"/>
	</changeSet>
	<changeSet id="ticket861_20150416" author="RachidAityaazza">
		<addColumn tableName="BILLING_INV_SUB_CAT_COUNTRY">
			<column name="FILTER_EL" type="VARCHAR(2000)"/>
		</addColumn>
		<createTable tableName="billing_invoice_agregate_taxes">
			<column name="subcategoryinvoiceaggregates_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="subcategorytaxes_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
		</createTable>
		<addForeignKeyConstraint baseColumnNames="subcategorytaxes_id"
			baseTableName="billing_invoice_agregate_taxes" constraintName="fkf7299c742bd9daa2"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id"
			referencedTableName="billing_tax" />
		<addForeignKeyConstraint baseColumnNames="subcategoryinvoiceaggregates_id"
			baseTableName="billing_invoice_agregate_taxes" constraintName="fkf7299c74c7ccdd2"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id"
			referencedTableName="billing_invoice_agregate" />
		<addColumn tableName="billing_invoice_agregate">
			<column name="sub_cat_invoice_agregate_id" type="BIGINT"/>
		</addColumn>
	<addForeignKeyConstraint baseColumnNames="sub_cat_invoice_agregate_id"
			baseTableName="billing_invoice_agregate" constraintName="fkc92fa77a520f2e17"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id"
			referencedTableName="billing_invoice_agregate" />
			
	</changeSet>
	<changeSet id="ticket704_20150416" author="AndriusKarpavicius">
		<addColumn tableName="ACCOUNT_ENTITY">
			<column name="account_type" type="VARCHAR(10)"/>
		</addColumn>
		<update tableName="ACCOUNT_ENTITY">
			<column name="account_type" value="ACCT_CUST"/>
			<where>id in (select id from CRM_CUSTOMER)</where>
		</update>
		<update tableName="ACCOUNT_ENTITY">
			<column name="account_type" value="ACCT_CA"/>
			<where>id in (select id from AR_CUSTOMER_ACCOUNT)</where>
		</update>
		<update tableName="ACCOUNT_ENTITY">
			<column name="account_type" value="ACCT_UA"/>
			<where>id in (select id from BILLING_USER_ACCOUNT)</where>
		</update>				
		<update tableName="ACCOUNT_ENTITY">
			<column name="account_type" value="ACCT_BA"/>
			<where>id in (select id from BILLING_BILLING_ACCOUNT)</where>
		</update>				
		<addNotNullConstraint tableName="ACCOUNT_ENTITY" columnName="account_type"/>
		<addUniqueConstraint columnNames="CODE, ACCOUNT_TYPE, PROVIDER_ID" tableName="ACCOUNT_ENTITY" constraintName="UK_ACCOUNT_ENTITY"/>
	</changeSet>
	<changeSet id="ticket528_20150421" author="Mbarek">
		<addColumn tableName="CAT_DISCOUNT_PLAN_ITEM">
			<column name="EXPRESSION_EL" type="VARCHAR(1000)"/>
		</addColumn>
	</changeSet>
	<changeSet id="ticket861_20150426" author="RachidAityaazza">
		<dropTable cascadeConstraints="true" tableName="billing_invoice_agregate_taxes"/>
		<createTable tableName="billing_invoice_agregate_taxes">
			<column name="sub_cat_invoice_aggregat_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="tax_id" type="BIGINT">
				<constraints nullable="false" />
			</column>
		</createTable>
		<addForeignKeyConstraint baseColumnNames="tax_id"
			baseTableName="billing_invoice_agregate_taxes" constraintName="fkf7299c74ade17a12"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id"
			referencedTableName="billing_tax" />
		<addForeignKeyConstraint baseColumnNames="sub_cat_invoice_aggregat_id"
			baseTableName="billing_invoice_agregate_taxes" constraintName="fkf7299c74d8f96095"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id"
			referencedTableName="billing_invoice_agregate" />
		<addColumn tableName="BILLING_INVOICE_AGREGATE">
            <column name="DISCOUNT_PLAN_CODE" type="VARCHAR(50)" />
        </addColumn>	
		<addColumn tableName="BILLING_INVOICE_AGREGATE">
			<column name="DISCOUNT_PLAN_ITEM_CODE" type="VARCHAR(50)" />
        </addColumn>
	</changeSet>
</databaseChangeLog>
