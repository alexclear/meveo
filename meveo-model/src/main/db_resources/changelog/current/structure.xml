<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd">

	<changeSet id="ticket703_20150429" author="Mbarek"> 
     <modifyDataType tableName="billing_invoice" columnName="invoice_number" newDataType="VARCHAR(50)"/>
   </changeSet>
	<changeSet id="ticket599_20150429" author="Mbarek">
	<addColumn tableName="AR_CUSTOMER_ACCOUNT">
	<column name="TRADING_LANGUAGE_ID" type="BIGINT"/>
	</addColumn>
	</changeSet>

	<changeSet id="ticket685_20150430" author="EdwardLegaspi">
		<validCheckSum>7:668fdc1cfd06732a26ba11882dbd29fc</validCheckSum>
	
		<addColumn tableName="billing_wallet_operation">
			<column name="input_quantity" type="numeric(23, 12)" />
			<column name="input_unit_description" type="varchar(20)" />
			<column name="rating_unit_description" type="varchar(20)" />
		</addColumn>
		
		<sql>UPDATE billing_wallet_operation set rating_unit_description=unity_description;</sql>
		
		<dropColumn columnName="unity_description" tableName="billing_wallet_operation" />

		<addColumn tableName="cat_charge_template">
			<column name="input_unit_description" type="varchar(20)" />
			<column name="rating_unit_description" type="varchar(20)" />
			<column name="unit_multiplicator" type="numeric(23, 12)" />
			<column name="unit_nb_decimal" type="int4" />
		</addColumn>
		
		<addColumn tableName="billing_usage_charge_inst">
			<column name="rating_unit_description" type="varchar(20)" />
		</addColumn>
		
		<sql>UPDATE cat_charge_template a SET rating_unit_description=(SELECT b.unity_description from cat_usage_charge_template b where b.id=a.id);</sql>
		<sql>UPDATE billing_usage_charge_inst set rating_unit_description=unity_description;</sql>

		<dropColumn columnName="unity_description" tableName="cat_usage_charge_template" />
		<dropColumn columnName="unity_multiplicator" tableName="cat_usage_charge_template" />
		<dropColumn columnName="unity_nb_decimal" tableName="cat_usage_charge_template" />
		<dropColumn columnName="unity_formatter" tableName="cat_usage_charge_template" />

		<dropColumn columnName="unity_description" tableName="billing_usage_charge_inst" />
	</changeSet>
	<changeSet id="ticket685_20150430" author="AndriusKarpavicius">
		<sql>update cat_charge_template set unit_nb_decimal=0 where unit_nb_decimal is null</sql>
	</changeSet>	
	
	<changeSet id="ticket646_20150506" author="SebastienMichea">
		<addColumn tableName="cat_wallet_template">
			<column name="low_balance_level" type="numeric(23, 12)" />
		</addColumn>
		<addColumn tableName="billing_wallet">
			<column name="low_balance_level" type="numeric(23, 12)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="ticket684_20150507" author="EdwardLegaspi">
		<createTable tableName="billing_invoice_configuration">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="version" type="INT4" />
			<column name="provider_id" type="BIGINT" />
			<column name="display_subscriptions" type="BOOL" />
			<column name="display_services" type="BOOL" />
			<column name="display_offers" type="BOOL" />
		</createTable>
		
		<createSequence sequenceName="billing_invoice_configuration_seq" startValue="2"/>

		<addForeignKeyConstraint constraintName="provider_invoice_configuration_fk"
			referencedTableName="crm_provider" baseColumnNames="provider_id"
			baseTableName="billing_invoice_configuration" referencedColumnNames="id"
			onDelete="CASCADE" onUpdate="CASCADE" />
	</changeSet>
	<changeSet id="ticket684_20150507-update" author="EdwardLegaspi-AndriusKarpavicius">
		<delete tableName="billing_invoice_configuration"/>
		<addColumn tableName="billing_invoice_configuration">
			<column name="disabled" type="BOOL">
				<constraints nullable="false" />
			</column>
			<column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
				<constraints nullable="false" />
			</column>
			<column name="updated" type="TIMESTAMP WITHOUT TIME ZONE" />
			<column name="creator_id" type="BIGINT" />
			<column name="updater_id" type="BIGINT" />
			<column name="code" type="VARCHAR(60)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="VARCHAR(100)" />
		</addColumn>
		<addPrimaryKey columnNames="id" constraintName="billing_invoice_configuration_pkey" tableName="billing_invoice_configuration" />
		<addForeignKeyConstraint baseColumnNames="creator_id" baseTableName="billing_invoice_configuration" constraintName="fk_invoice_configuration_creator"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
		<addForeignKeyConstraint baseColumnNames="updater_id" baseTableName="billing_invoice_configuration" constraintName="fk_invoice_configuration_updater"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
	</changeSet>	
	<changeSet id="ticket599_20150507" author="Mbarek">
		<sql>update ar_customer_account set trading_language_id=(select trading_language_id from billing_billing_account  where billing_billing_account.customer_account_id=ar_customer_account.id ORDER BY billing_billing_account.id ASC LIMIT 1)</sql>
	</changeSet> 
	
	<changeSet id="ticket895_20150623" author="Mbarek">
		<addColumn tableName="RATING_EDR">
		<column name="PARAMETER_5" type="VARCHAR(255)"/>
		<column name="PARAMETER_6" type="VARCHAR(255)"/>
		<column name="PARAMETER_7" type="VARCHAR(255)"/>
		<column name="PARAMETER_8" type="VARCHAR(255)"/>
		<column name="PARAMETER_9" type="VARCHAR(255)"/>
		<column name="DATE_PARAMETER_1" type="TIMESTAMP WITHOUT TIME ZONE"/>
		<column name="DATE_PARAMETER_2" type="TIMESTAMP WITHOUT TIME ZONE"/>
		<column name="DATE_PARAMETER_3" type="TIMESTAMP WITHOUT TIME ZONE"/>
		<column name="DATE_PARAMETER_4" type="TIMESTAMP WITHOUT TIME ZONE"/>
		<column name="DATE_PARAMETER_5" type="TIMESTAMP WITHOUT TIME ZONE"/>
		<column name="DECIMAL_PARAMETER_1" type="numeric(23, 12)"/>
		<column name="DECIMAL_PARAMETER_2" type="numeric(23, 12)"/>
		<column name="DECIMAL_PARAMETER_3" type="numeric(23, 12)"/>
		<column name="DECIMAL_PARAMETER_4" type="numeric(23, 12)"/>
		<column name="DECIMAL_PARAMETER_5" type="numeric(23, 12)"/>
		</addColumn>
	</changeSet> 
	
	<changeSet id="ticket903_20150625" author="Mbarek">
		<addColumn tableName="RATING_EDR">
		<column name="ACCESS_CODE" type="VARCHAR(255)"/>
		</addColumn>
	</changeSet>  
	
	<changeSet author="anasseh (generated)" id="1432229915728-1">
		<createTable tableName="com_meveo_instance">
			<column name="id" type="BIGINT">
				<constraints nullable="false" />
			</column>
			<column name="version" type="INT4" />
			<column name="disabled" type="BOOL">
				<constraints nullable="false" />
			</column>
			<column name="created" type="TIMESTAMP WITHOUT TIME ZONE">
				<constraints nullable="false" />
			</column>
			<column name="updated" type="TIMESTAMP WITHOUT TIME ZONE" />
			<column name="code" type="VARCHAR(60)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="VARCHAR(100)" />
			<column name="as_vendor" type="VARCHAR(255)" />
			<column name="as_version" type="VARCHAR(255)" />
			<column name="creation_date" type="TIMESTAMP WITHOUT TIME ZONE" />
			<column name="hd_size" type="VARCHAR(255)" />
			<column name="installation_mode" type="VARCHAR(255)" />
			<column name="java_vendor" type="VARCHAR(255)" />
			<column name="java_version" type="VARCHAR(255)" />
			<column name="java_vm_name" type="VARCHAR(255)" />
			<column name="java_vm_version" type="VARCHAR(255)" />
			<column name="key_entreprise" type="VARCHAR(255)" />
			<column name="mac_address" type="VARCHAR(255)" />
			<column name="machine_vendor" type="VARCHAR(255)" />
			<column name="md5" type="VARCHAR(255)" />
			<column name="memory" type="VARCHAR(255)" />
			<column name="nb_cores" type="VARCHAR(255)" />
			<column name="os_arch" type="VARCHAR(255)" />
			<column name="os_name" type="VARCHAR(255)" />
			<column name="ps_version" type="VARCHAR(255)" />
			<column name="owner" type="VARCHAR(255)" />
			<column name="product_name" type="VARCHAR(255)" />
			<column name="product_version" type="VARCHAR(255)" />
			<column name="status" type="VARCHAR(255)" />
			<column name="update_date" type="TIMESTAMP WITHOUT TIME ZONE" />
			<column name="provider_id" type="BIGINT" />
			<column name="creator_id" type="BIGINT" />
			<column name="updater_id" type="BIGINT" />
			<column name="user_id" type="BIGINT" />
			<column name="customer_id" type="BIGINT" />
		</createTable>
	</changeSet>
	<changeSet author="anasseh (generated)" id="1432229915728-3">
		<addPrimaryKey columnNames="id" constraintName="com_meveo_instance_pkey"
			tableName="com_meveo_instance" />
	</changeSet>

	<changeSet author="anasseh (generated)" id="1432229915728-5">
		<addUniqueConstraint columnNames="code"
			constraintName="uk_p7r8cy3d1w7g8pir7rxq17071" deferrable="false"
			disabled="false" initiallyDeferred="false" tableName="com_meveo_instance" />
	</changeSet>

	<changeSet author="anasseh (generated)" id="1432229915728-6">
		<addForeignKeyConstraint baseColumnNames="customer_id"
			baseTableName="com_meveo_instance" constraintName="fk_398jtw7cvvcjmyalvke9iwoqw"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_customer" />
	</changeSet>
	<changeSet author="anasseh (generated)" id="1432229915728-4">
		<addForeignKeyConstraint baseColumnNames="user_id"
			baseTableName="com_meveo_instance" constraintName="fk_userid"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
	</changeSet>
	<changeSet author="anasseh (generated)" id="1432229915728-7">
		<addForeignKeyConstraint baseColumnNames="creator_id"
			baseTableName="com_meveo_instance" constraintName="fk_2kqwodw5jh9dju2f2m3853y0c"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
	</changeSet>
	<changeSet author="anasseh (generated)" id="1432229915728-8">
		<addForeignKeyConstraint baseColumnNames="updater_id"
			baseTableName="com_meveo_instance" constraintName="fk_6mn1jku9a27nleamaqyke2c63"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="adm_user" />
	</changeSet>

	<changeSet author="anasseh (generated)" id="1432229915728-13">
		<addForeignKeyConstraint baseColumnNames="provider_id"
			baseTableName="com_meveo_instance" constraintName="fk_simrfknulxj9dfm6v03k4ejmh"
			deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
			onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />
	</changeSet>
	<changeSet author="anasseh (generated)" id="1432229915728-20">
		<createSequence sequenceName="com_meveo_instance_seq" />
	</changeSet>
	 
</databaseChangeLog>
